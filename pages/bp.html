<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹˜æœºäººä¿¡æ¯æ‰¹é‡å¯¼å…¥å·¥å…· - å¢å¼ºç‰ˆ</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #eef2ff;
            --secondary-color: #06d6a0;
            --secondary-dark: #05b989;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #2b2d42;
            --gray-color: #8d99ae;
            --gray-light: #f1f3f9;
            --warning-color: #f8961e;
            --danger-color: #ef476f;
            --success-color: #06d6a0;
            --border-radius: 12px;
            --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --font-size-base: 16px;
            --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 15px 35px rgba(0, 0, 0, 0.2);
            --border-light: 1px solid #e8e8e8;
            --border-medium: 1px solid #d0d0d0;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }
        
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
            font-size: var(--font-size-base);
            scroll-behavior: smooth;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
            transform: translateZ(0);
        }
        
        .header {
            background: linear-gradient(135deg, var(--dark-color), var(--primary-dark));
            color: white;
            padding: 35px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .header h1 {
            font-size: 32px;
            margin: 0;
            font-weight: 700;
            position: relative;
            z-index: 1;
            letter-spacing: 0.5px;
        }
        
        .header p {
            margin: 15px 0 0;
            opacity: 0.9;
            font-size: 18px;
            position: relative;
            z-index: 1;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }
        
        .content {
            padding: 30px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            margin-bottom: 25px;
            overflow: hidden;
            border: var(--border-light);
            transition: var(--transition-slow);
            transform: translateZ(0);
        }
        
        .card:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 20px 25px;
            border-bottom: var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-header h3 {
            margin: 0;
            color: var(--dark-color);
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .card-header h3::before {
            content: "";
            display: inline-block;
            width: 5px;
            height: 20px;
            background: var(--primary-color);
            margin-right: 15px;
            border-radius: 3px;
        }
        
        .card-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 16px;
        }
        
        textarea {
            width: 100%;
            height: 180px;
            padding: 16px;
            border: var(--border-medium);
            border-radius: 8px;
            resize: vertical;
            line-height: 1.6;
            transition: var(--transition);
            font-size: 15px;
            font-family: inherit;
        }
        
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition-normal);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            min-width: 160px;
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--secondary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-secondary {
            background: var(--gray-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d35400;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-info {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-info:hover {
            background: #5a0a9c;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .instructions {
            background: linear-gradient(to right, #e8f4fd, #f0f8ff);
            border-left: 4px solid var(--primary-color);
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 0 8px 8px 0;
        }
        
        .instructions h3 {
            margin: 0 0 15px;
            color: var(--dark-color);
            font-size: 20px;
            display: flex;
            align-items: center;
        }
        
        .instructions h3::before {
            content: "ğŸ’¡";
            margin-right: 12px;
            font-size: 22px;
        }
        
        .instructions ul {
            margin: 0;
            padding-left: 25px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
            font-size: 15px;
        }
        
        .info-text {
            color: #666;
            text-align: left;
            padding: 2px 4px;
            font-size: 10px;
            line-height: 1.3;
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: white;
            padding: 35px;
            border-radius: 16px;
            width: 500px;
            box-shadow: var(--shadow-heavy);
            transform: translateY(-30px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: translateZ(0);
            position: relative;
            overflow: hidden;
        }
        
        .modal-content::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .modal.show .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        
        .modal-header {
            margin-bottom: 25px;
            color: var(--dark-color);
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .modal-header::before {
            content: "ğŸ“±";
            margin-right: 15px;
            font-size: 24px;
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .modal-body input {
            width: 100%;
            padding: 16px;
            border: var(--border-medium);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .modal-body input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .modal-footer button {
            padding: 12px 24px;
            min-width: 120px;
        }
        
        /* é«˜çº§å¼¹çª—æ ·å¼ */
        .advanced-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(6px);
        }
        
        .advanced-modal-content {
            background: white;
            border-radius: 20px;
            width: 450px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: translateY(-40px) scale(0.9);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            overflow: hidden;
            position: relative;
        }
        
        .advanced-modal.show .advanced-modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        
        .advanced-modal-header {
            padding: 25px 30px 10px;
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
        }
        
        .advanced-modal-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .advanced-modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .advanced-modal-body {
            padding: 25px 30px;
            text-align: center;
            color: var(--dark-color);
            font-size: 16px;
            line-height: 1.6;
        }
        
        .advanced-modal-footer {
            padding: 20px 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-top: 1px solid #f0f0f0;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: #f8f9fa;
            border-top: var(--border-light);
            font-size: 15px;
            color: #666;
        }
        
        .passenger-count {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .passenger-count::before {
            content: "ğŸ‘¥";
            font-size: 18px;
        }
        
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            transition: var(--transition-slow);
        }
        
        .progress-step.active {
            background: var(--primary-color);
            transform: scale(1.3);
            animation: pulse 2s infinite;
        }
        
        .input-hint {
            font-size: 13px;
            color: var(--gray-color);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-hint::before {
            content: "ğŸ’¡";
            font-size: 13px;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn-icon {
            background: transparent;
            border: var(--border-light);
            color: var(--dark-color);
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            min-width: auto;
            font-size: 14px;
        }
        
        .btn-icon:hover {
            background: var(--gray-light);
            transform: none;
            box-shadow: none;
        }
        
        /* å®æ—¶è¯†åˆ«ç»“æœåŒºåŸŸ */
        .real-time-results {
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            border: var(--border-light);
            display: none;
            background: white;
            box-shadow: var(--shadow-light);
        }
        
        .results-header {
            background: var(--primary-light);
            padding: 12px 20px;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .results-header::before {
            content: "ğŸ‘¤";
            font-size: 18px;
        }
        
        .results-body {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .passenger-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            will-change: transform;
        }
        
        .passenger-item:hover {
            background-color: #f8f9ff;
            border-left-color: var(--primary-color);
        }
        
        .passenger-item:last-child {
            border-bottom: none;
        }
        
        .passenger-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }
        
        .passenger-name, .passenger-id {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .passenger-name .label, .passenger-id .label {
            font-weight: 600;
            color: var(--dark-color);
            min-width: 60px;
        }
        
        .passenger-name .value, .passenger-id .value {
            flex: 1;
            font-weight: 600;
            color: var(--dark-color);
            font-size: calc(var(--font-size-base) + 2px);
        }
        
        .passenger-id .value {
            color: var(--primary-color);
        }
        
        .passenger-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            min-width: auto;
        }
        
        .passenger-item.highlight {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning-color);
        }
        
        .no-passengers {
            padding: 20px;
            text-align: center;
            color: var(--gray-color);
            font-style: italic;
        }
        
        /* éèº«ä»½è¯è¯ä»¶ä¿¡æ¯è¡¨å•æ ·å¼ - ä¼˜åŒ–ç‰ˆ */
        .passenger-document-info {
            margin-top: 15px;
            padding: 20px;
            background: linear-gradient(to right, #f8f9ff, #f0f4ff);
            border-radius: 10px;
            border: 1px solid #e1e5f1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .document-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            flex: 2;
        }
        
        .form-group label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            display: flex;
            align-items: center;
        }
        
        .form-group label::before {
            content: "â€¢";
            color: var(--primary-color);
            margin-right: 8px;
            font-weight: bold;
        }
        
        .document-form input,
        .document-form select {
            padding: 10px 14px;
            border: 1px solid #d1d5e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: white;
        }
        
        .document-form input:focus,
        .document-form select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .foreign-passenger .passenger-document-info {
            display: block;
        }
        
        .normal-passenger .passenger-document-info {
            display: none;
        }
        
        /* ç¦ç”¨çŠ¶æ€æ ·å¼ */
        .document-form input:disabled,
        .document-form select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }
        
        /* å„¿ç«¥æç¤ºæ ·å¼ */
        .child-warning {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .child-warning::before {
            content: "âš ï¸";
        }
        
        /* ç¼–è¾‘æ¨¡å¼æ ·å¼ */
        .passenger-item.editing .passenger-name .value,
        .passenger-item.editing .passenger-id .value {
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 4px 8px;
            background: white;
        }
        
        .passenger-item.editing {
            background-color: #f0f8ff;
            border-left: 4px solid var(--primary-color);
        }
        
        .passenger-item.editing .passenger-document-info {
            background: linear-gradient(to right, #f0f8ff, #e8f4ff);
            border-color: #cfe2ff;
        }
        
        /* å­—ä½“å¤§å°è°ƒèŠ‚æ§ä»¶ */
        .font-size-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .font-size-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        
        .font-size-btn:hover {
            background: var(--primary-dark);
        }
        
        .font-size-value {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
        }
        
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* é€‰æ‹©æ–‡æœ¬æ ·å¼ */
        ::selection {
            background: rgba(67, 97, 238, 0.2);
            color: inherit;
        }

        /* å ä½ç¬¦æ ·å¼ */
        ::placeholder {
            color: #aaa;
            opacity: 1;
        }

        /* ç¦ç”¨çŠ¶æ€æ ·å¼ */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        button:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            display: flex;
            gap: 20px;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .stat-label {
            color: #666;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* æœç´¢æ¡† */
        .search-box {
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }
        
        /* æ‰¹é‡æ“ä½œåŒºåŸŸ */
        .batch-actions {
            display: none;
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            gap: 10px;
        }
        
        /* å¤é€‰æ¡†æ ·å¼ */
        .passenger-checkbox {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
        
        /* æ¨¡æ¿åˆ—è¡¨ */
        .template-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #eaeaea;
            border-radius: 4px;
        }
        
        .template-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .template-item:hover {
            background: #f8f9fa;
        }
        
        .template-item:last-child {
            border-bottom: none;
        }
        
        /* è®¾ç½®ç»„ */
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        /* å¤é€‰æ¡†æ ·å¼ */
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        /* åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* æ‰“å°æ ·å¼ */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .container {
                box-shadow: none !important;
                margin: 0 !important;
            }
            
            .card {
                box-shadow: none !important;
                border: 1px solid #000 !important;
            }
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .modal-content {
                width: 90%;
                margin: 0 10px;
                padding: 25px;
            }
            
            .advanced-modal-content {
                width: 90%;
                margin: 0 10px;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .passenger-item {
                flex-direction: column;
                gap: 12px;
            }
            
            .passenger-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .results-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .template-table {
                border: none;
            }
            
            table {
                min-width: auto;
                font-size: 11px;
            }
            
            th, td {
                padding: 4px 6px;
                height: 28px;
            }
            
            .col-A, .col-B, .col-C, .col-D, .col-F, .col-K, .col-P, .col-Q, 
            .col-R, .col-T, .col-U, .col-V, .col-W, .col-Y {
                width: 40px !important;
            }
            
            .stats-panel {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 1024px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .content {
                padding: 20px 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
                background: white;
            }
            
            .container {
                margin: 0;
                box-shadow: none;
                border-radius: 0;
            }
            
            .header {
                border-radius: 0;
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .card-body {
                padding: 20px 15px;
            }
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            display: none;
            font-size: 15px;
            animation: slideInDown 0.5s ease-out;
        }
        
        .success-message::before {
            content: "âœ…";
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            display: none;
            font-size: 15px;
            animation: slideInDown 0.5s ease-out;
        }
        
        .error-message::before {
            content: "âŒ";
        }
        
        /* ç¡®è®¤é¡µé¢æ ·å¼ */
        .confirm-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .confirm-header {
            background: linear-gradient(135deg, var(--dark-color), var(--primary-dark));
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .confirm-header h2 {
            margin: 0;
            font-size: 28px;
        }
        
        .confirm-actions {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 35px;
        }
        
        /* æ¨¡æ¿è¡¨æ ¼æ ·å¼ */
        .template-table {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: auto;
            margin-top: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            max-height: 70vh;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 1200px;
        }
        
        th, td {
            border: 1px solid #d0d0d0;
            padding: 8px;
            text-align: center;
            word-wrap: break-word;
            vertical-align: middle;
            height: 32px;
            font-size: 12px;
        }
        
        th {
            background: #f2f2f2;
            font-weight: 600;
            color: var(--dark-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .example-row {
            background: #e8f4fd;
        }
        
        .editable-cell {
            background: white;
        }
        
        .editable-cell input, .editable-cell select {
            width: 100%;
            border: none;
            padding: 5px;
            background: transparent;
            height: 24px;
            font-size: 12px;
            text-align: center;
        }
        
        .editable-cell input:focus, .editable-cell select:focus {
            outline: 1px solid var(--primary-color);
            border-radius: 3px;
        }
        
        .section-title {
            font-weight: bold;
            background: #f2f2f2;
            text-align: left;
            padding: 12px 18px;
            color: var(--dark-color);
            font-size: 15px;
        }
        
        .warning-row {
            background: #fff8e1;
            text-align: center;
            font-style: italic;
            color: var(--warning-color);
            font-size: 13px;
        }
        
        .empty-row {
            height: 12px;
        }
        
        .group-title {
            background: #e6f2ff;
            font-weight: bold;
            text-align: center;
            color: var(--dark-color);
        }
        
        .required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        .col-A { width: 25px; }
        .col-B { width: 50px; }
        .col-C { width: 60px; }
        .col-D { width: 50px; }
        .col-E { width: 100px; }
        .col-F { width: 50px; }
        .col-G { width: 80px; }
        .col-H { width: 100px; }
        .col-I { width: 90px; }
        .col-J { width: 90px; }
        .col-K { width: 40px; }
        .col-L { width: 80px; }
        .col-M { width: 80px; }
        .col-N { width: 80px; }
        .col-O { width: 80px; }
        .col-P { width: 60px; }
        .col-Q { width: 60px; }
        .col-R { width: 60px; }
        .col-S { width: 80px; }
        .col-T { width: 50px; }
        .col-U { width: 60px; }
        .col-V { width: 60px; }
        .col-W { width: 60px; }
        .col-X { width: 80px; }
        .col-Y { width: 50px; }
        
        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(67, 97, 238, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(67, 97, 238, 0);
            }
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>ä¹˜æœºäººä¿¡æ¯æ‰¹é‡å¯¼å…¥å·¥å…· - å¢å¼ºç‰ˆ</h1>
            <p>æ ¹æ®è¾“å…¥çš„ä¹˜æœºäººä¿¡æ¯ç”Ÿæˆç¬¦åˆæ¨¡æ¿è¦æ±‚çš„Excelæ–‡ä»¶ï¼Œç®€åŒ–æ•°æ®å½•å…¥æµç¨‹</p>
        </div>
        
        <div class="content">
            <div class="instructions">
                <h3>ä½¿ç”¨è¯´æ˜</h3>
                <ul>
                    <li>è¯·åœ¨ä¸‹æ–¹è¾“å…¥ä¹˜æœºäººä¿¡æ¯ï¼Œæ”¯æŒå•ä¸ªæˆ–å¤šä¸ªä¹˜æœºäººæ ¼å¼</li>
                    <li>ç³»ç»Ÿå°†å®æ—¶è¯†åˆ«ä¹˜æœºäººä¿¡æ¯å¹¶åœ¨ä¸‹æ–¹æ˜¾ç¤º</li>
                    <li>æ‚¨å¯ä»¥ç¼–è¾‘å·²è¯†åˆ«çš„ä¹˜æœºäººä¿¡æ¯ï¼Œä¿®æ”¹åè¯·ç‚¹å‡»ä¿å­˜</li>
                    <li>ç¡®è®¤ä¿¡æ¯æ— è¯¯åï¼Œç‚¹å‡»"ç”Ÿæˆè¡¨å•"æŒ‰é’®ç”Ÿæˆå®Œæ•´è¡¨å•</li>
                    <li>æ‚¨å¯ä»¥åœ¨è¡¨æ ¼ä¸­ç›´æ¥ç¼–è¾‘ä¿¡æ¯ï¼Œæ‰€æœ‰ä¿®æ”¹å°†å®æ—¶ä¿å­˜</li>
                    <li>ç¡®è®¤ä¿¡æ¯æ— è¯¯åï¼Œç‚¹å‡»"å¯¼å‡ºExcel"æŒ‰é’®ç”Ÿæˆç¬¦åˆæ¨¡æ¿è¦æ±‚çš„Excelæ–‡ä»¶</li>
                    <li><strong>å¿«æ·é”®ï¼š</strong> Ctrl+Enter ç”Ÿæˆè¡¨å•ï¼ŒEsc å…³é—­å¼¹çª—</li>
                </ul>
            </div>
            
            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div class="stats-panel">
                <div class="stat-item">
                    <span class="stat-label">æ€»äººæ•°:</span>
                    <span class="stat-value" id="totalCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æˆäºº:</span>
                    <span class="stat-value" id="adultCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">å„¿ç«¥:</span>
                    <span class="stat-value" id="childCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">å©´å„¿:</span>
                    <span class="stat-value" id="infantCount">0</span>
                </div>
            </div>
            
            <div id="successMessage" class="success-message">
                ä¹˜æœºäººä¿¡æ¯å·²æˆåŠŸè¯†åˆ«å¹¶åŠ è½½åˆ°è¡¨æ ¼ä¸­ï¼
            </div>
            
            <div id="errorMessage" class="error-message">
                æ— æ³•è¯†åˆ«ä¹˜æœºäººä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>ä¹˜æœºäººä¿¡æ¯è¾“å…¥</h3>
                    <div class="action-buttons">
                        <button class="btn-icon" title="æ¸…ç©ºè¾“å…¥æ¡†" id="clearInputBtn">
                            <i class="fas fa-trash"></i> æ¸…ç©ºè¾“å…¥æ¡†
                        </button>
                        <button class="btn-icon" title="æŸ¥çœ‹è¾“å…¥ç¤ºä¾‹" id="exampleBtn">
                            <i class="fas fa-eye"></i> æŸ¥çœ‹ç¤ºä¾‹
                        </button>
                        <button class="btn-icon" title="å¯¼å…¥Excel" id="importExcelBtn">
                            <i class="fas fa-file-import"></i> å¯¼å…¥Excel
                        </button>
                        <button class="btn-icon" title="æ•°æ®å¤‡ä»½" id="backupBtn">
                            <i class="fas fa-download"></i> å¤‡ä»½æ•°æ®
                        </button>
                        <button class="btn-icon" title="è®¾ç½®" id="settingsBtn">
                            <i class="fas fa-cog"></i> è®¾ç½®
                        </button>
                        <button class="btn-icon" title="å¿«æ·é”®" id="shortcutsBtn">
                            <i class="fas fa-keyboard"></i> å¿«æ·é”®
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="passengerInput" class="form-label">è¯·è¾“å…¥ä¹˜æœºäººä¿¡æ¯</label>
                        <textarea id="passengerInput" placeholder="è¯·è¾“å…¥ä¹˜æœºäººä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š
ä¹˜æœºäººï¼šå¼ ä¸‰ 
èº«ä»½è¯ï¼š110101199001011234 
ç¥¨å·ï¼š8592172332735 
èˆªç­å·ï¼š8L9826 
èµ·é™åœ°ï¼šæ­¦æ±‰å¤©æ²³æœºåœºT2-ä¸½æ±Ÿä¸‰ä¹‰æœºåœº 
èµ·é£æ—¶é—´ï¼š2025-10-12 10:30-12:45

æˆ–å¤šä¸ªä¹˜æœºäººæ ¼å¼ï¼š
ä¹˜æœºäºº1ï¼šæå›› 
èº«ä»½è¯ï¼š110101199001011235 
ç¥¨å·ï¼š8592172332739 
ä¹˜æœºäºº2ï¼šç‹äº” 
èº«ä»½è¯ï¼š110101199001011236 
ç¥¨å·ï¼š8592172332736 
ä¹˜æœºäºº3ï¼šèµµå…­ 
èº«ä»½è¯ï¼š110101199001011237 
ç¥¨å·ï¼š8592172332738 
ä¹˜æœºäºº4ï¼šé’±ä¸ƒ 
èº«ä»½è¯ï¼š110101199001011238 
ç¥¨å·ï¼š8592172332740 
ä¹˜æœºäºº5ï¼šå­™å…« 
èº«ä»½è¯ï¼š110101199001011239 
ç¥¨å·ï¼š8592172332737 
èˆªç­å·ï¼š8L9826 
èµ·é™åœ°ï¼šæ­¦æ±‰å¤©æ²³æœºåœºT2-ä¸½æ±Ÿä¸‰ä¹‰æœºåœº 
èµ·é£æ—¶é—´ï¼š2025-10-12 10:30-12:45"></textarea>
                        <div class="input-hint">æç¤ºï¼šè¯·æŒ‰ç…§ç¤ºä¾‹æ ¼å¼è¾“å…¥ä¹˜æœºäººä¿¡æ¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«</div>
                    </div>
                    
                    <!-- æœç´¢æ¡† -->
                    <div class="search-box" id="searchBox" style="display: none;">
                        <input type="text" id="searchInput" placeholder="æœç´¢ä¹˜æœºäººå§“åæˆ–èº«ä»½è¯..." style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    
                    <!-- æ‰¹é‡æ“ä½œåŒºåŸŸ -->
                    <div class="batch-actions" id="batchActions">
                        <button id="batchEditBtn" class="btn-small btn-warning">
                            <i class="fas fa-edit"></i> æ‰¹é‡ç¼–è¾‘
                        </button>
                        <button id="batchDeleteBtn" class="btn-small btn-danger">
                            <i class="fas fa-trash"></i> æ‰¹é‡åˆ é™¤
                        </button>
                        <button id="cancelBatchBtn" class="btn-small btn-secondary">
                            <i class="fas fa-times"></i> å–æ¶ˆ
                        </button>
                    </div>
                    
                    <!-- å®æ—¶è¯†åˆ«ç»“æœåŒºåŸŸ -->
                    <div class="real-time-results" id="realTimeResults">
                        <div class="results-header">
                            <span>å·²è¯†åˆ«ä¹˜æœºäººä¿¡æ¯</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="btn-small btn-info" id="toggleSearchBtn">
                                    <i class="fas fa-search"></i> æœç´¢
                                </button>
                                <button class="btn-small btn-info" id="toggleBatchBtn">
                                    <i class="fas fa-check-square"></i> æ‰¹é‡æ“ä½œ
                                </button>
                                <div class="font-size-control">
                                    <span>å­—ä½“å¤§å°:</span>
                                    <button class="font-size-btn" id="decreaseFontBtn">-</button>
                                    <span class="font-size-value" id="fontSizeValue">16</span>
                                    <button class="font-size-btn" id="increaseFontBtn">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="results-body" id="resultsBody">
                            <!-- å®æ—¶è¯†åˆ«ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button id="generateFormBtn" class="btn-primary">
                            <i class="fas fa-file-alt"></i> ç”Ÿæˆè¡¨å•
                        </button>
                        <button id="printBtn" class="btn-secondary no-print">
                            <i class="fas fa-print"></i> æ‰“å°é¢„è§ˆ
                        </button>
                        <button id="resetBtn" class="btn-secondary">
                            <i class="fas fa-redo"></i> é‡ç½®æ‰€æœ‰
                        </button>
                    </div>
                </div>
                <div class="status-bar">
                    <div class="passenger-count">å·²è¯†åˆ«ä¹˜æœºäºº: <span id="passengerCount">0</span> äºº</div>
                    <div class="progress-indicator">
                        <span>æ“ä½œè¿›åº¦:</span>
                        <div class="progress-step" id="step1"></div>
                        <div class="progress-step" id="step2"></div>
                        <div class="progress-step" id="step3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶ä¸Šä¼ è¾“å…¥ -->
    <input type="file" id="excelFileInput" accept=".xlsx, .xls" style="display: none;">
    <input type="file" id="jsonFileInput" accept=".json" style="display: none;">

    <!-- æ‰‹æœºå·ç å¼¹çª— -->
    <div id="phoneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">è¯·å¡«å†™ä¹˜æœºäººè®¢å•é¢„ç•™å·ç </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666; line-height: 1.5;">è¯·è¾“å…¥ä¹˜æœºäººçš„è®¢å•é¢„ç•™æ‰‹æœºå·ç ï¼Œè¯¥å·ç å°†åº”ç”¨äºæ‰€æœ‰ä¹˜æœºäººã€‚</p>
                <input type="text" id="phoneInput" placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç " maxlength="11">
                <div class="input-hint" style="margin-top: 12px;">æç¤ºï¼šè¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç æ ¼å¼ï¼Œå¦‚ 13800138000</div>
            </div>
            <div class="modal-footer">
                <button id="cancelPhone" class="btn-secondary">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
                <button id="confirmPhone" class="btn-primary">
                    <i class="fas fa-check"></i> ç¡®è®¤
                </button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®æ¨¡æ€çª—å£ -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">è®¾ç½®</div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="autoSaveSetting"> è‡ªåŠ¨ä¿å­˜æ•°æ®
                    </label>
                </div>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="validateIdSetting"> å®æ—¶éªŒè¯èº«ä»½è¯å·ç 
                    </label>
                </div>
                <div class="setting-group">
                    <label>é»˜è®¤æ‰‹æœºå·å‰ç¼€:</label>
                    <input type="text" id="defaultPhonePrefix" value="86" maxlength="5" style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div class="setting-group">
                    <label>æ•°æ®å¤‡ä»½/æ¢å¤:</label>
                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                        <button id="exportDataBtn" class="btn-small btn-success">
                            <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                        </button>
                        <button id="importDataBtn" class="btn-small btn-primary">
                            <i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettings" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                <button id="closeSettings" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- é«˜çº§å¼¹çª— - ç”¨äºç¡®è®¤åˆ é™¤ -->
    <div id="confirmDeleteModal" class="advanced-modal">
        <div class="advanced-modal-content">
            <div class="advanced-modal-header">
                <div class="advanced-modal-icon">ğŸ—‘ï¸</div>
                <div class="advanced-modal-title">ç¡®è®¤åˆ é™¤</div>
            </div>
            <div class="advanced-modal-body">
                <p id="confirmDeleteText">ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ä¹˜æœºäººå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
            </div>
            <div class="advanced-modal-footer">
                <button id="cancelDelete" class="btn-secondary">å–æ¶ˆ</button>
                <button id="confirmDelete" class="btn-danger">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- é«˜çº§å¼¹çª— - ç”¨äºæˆåŠŸæç¤º -->
    <div id="successModal" class="advanced-modal">
        <div class="advanced-modal-content">
            <div class="advanced-modal-header">
                <div class="advanced-modal-icon">âœ…</div>
                <div class="advanced-modal-title">æ“ä½œæˆåŠŸ</div>
            </div>
            <div class="advanced-modal-body">
                <p id="successModalText">æ“ä½œå·²æˆåŠŸå®Œæˆï¼</p>
            </div>
            <div class="advanced-modal-footer">
                <button id="closeSuccessModal" class="btn-success">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- é«˜çº§å¼¹çª— - ç”¨äºé”™è¯¯æç¤º -->
    <div id="errorModal" class="advanced-modal">
        <div class="advanced-modal-content">
            <div class="advanced-modal-header">
                <div class="advanced-modal-icon">âŒ</div>
                <div class="advanced-modal-title">æ“ä½œå¤±è´¥</div>
            </div>
            <div class="advanced-modal-body">
                <p id="errorModalText">æ“ä½œæœªèƒ½å®Œæˆï¼Œè¯·æ£€æŸ¥è¾“å…¥æˆ–é‡è¯•ã€‚</p>
            </div>
            <div class="advanced-modal-footer">
                <button id="closeErrorModal" class="btn-secondary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤é¡µé¢ -->
    <div id="confirmPage" class="confirm-page">
        <div class="confirm-header">
            <h2>ä¹˜æœºäººä¿¡æ¯ç¡®è®¤ - å›ºå®šæ¨¡æ¿æ ¼å¼</h2>
            <button id="closeConfirm" class="btn-secondary no-print">
                <i class="fas fa-times"></i> å…³é—­
            </button>
        </div>
        
        <div class="template-table">
            <table id="passengerTable">
                <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </table>
        </div>
        
        <div class="confirm-actions no-print">
            <button id="backToEdit" class="btn-warning">
                <i class="fas fa-edit"></i> è¿”å›ä¿®æ”¹
            </button>
            <button id="confirmExport" class="btn-success">
                <i class="fas fa-file-export"></i> å¯¼å‡ºExcel
            </button>
        </div>
    </div>

    <script>
        // å­˜å‚¨ä¹˜æœºäººæ•°æ®
        let passengers = [];
        let currentPhone = '';
        let fontSize = 16; // é»˜è®¤å­—ä½“å¤§å°
        
        // å­˜å‚¨è®¾ç½®
        let settings = {
            autoSave: false,
            validateId: true,
            defaultPhonePrefix: '86'
        };
        
        // æ“ä½œå†å²
        let operationHistory = [];
        
        // åˆå§‹åŒ–è¿›åº¦æŒ‡ç¤ºå™¨
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress(1);
            
            // åŠ è½½è®¾ç½®
            loadSettings();
            
            // åŠ è½½æœ¬åœ°æ•°æ®
            loadFromLocalStorage();
            
            // æ·»åŠ è¾“å…¥æ¡†å®æ—¶ç›‘å¬
            document.getElementById('passengerInput').addEventListener('input', function() {
                updateRealTimeResults();
                // è‡ªåŠ¨è°ƒæ•´é«˜åº¦
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // å­—ä½“å¤§å°è°ƒèŠ‚
            document.getElementById('increaseFontBtn').addEventListener('click', function() {
                if (fontSize < 24) {
                    fontSize += 2;
                    updateFontSize();
                }
            });
            
            document.getElementById('decreaseFontBtn').addEventListener('click', function() {
                if (fontSize > 12) {
                    fontSize -= 2;
                    updateFontSize();
                }
            });
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ç¼–è¾‘å’Œä¿å­˜æŒ‰é’®
            document.getElementById('resultsBody').addEventListener('click', function(e) {
                // ç¼–è¾‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                if (e.target.classList.contains('edit-btn') || e.target.closest('.edit-btn')) {
                    const btn = e.target.classList.contains('edit-btn') ? e.target : e.target.closest('.edit-btn');
                    const index = parseInt(btn.getAttribute('data-index'));
                    editPassenger(index);
                }
                
                // ä¿å­˜æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                if (e.target.classList.contains('save-btn') || e.target.closest('.save-btn')) {
                    const btn = e.target.classList.contains('save-btn') ? e.target : e.target.closest('.save-btn');
                    const index = parseInt(btn.getAttribute('data-index'));
                    savePassenger(index);
                }
            });
            
            // å¯¼å…¥ExcelåŠŸèƒ½
            document.getElementById('importExcelBtn').addEventListener('click', function() {
                document.getElementById('excelFileInput').click();
            });
            
            document.getElementById('excelFileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importExcelFile(e.target.files[0]);
                }
            });
            
            // æ•°æ®å¤‡ä»½åŠŸèƒ½
            document.getElementById('backupBtn').addEventListener('click', exportData);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            
            // æ•°æ®å¯¼å…¥åŠŸèƒ½
            document.getElementById('importDataBtn').addEventListener('click', function() {
                document.getElementById('jsonFileInput').click();
            });
            
            document.getElementById('jsonFileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                }
            });
            
            // è®¾ç½®åŠŸèƒ½
            document.getElementById('settingsBtn').addEventListener('click', function() {
                showSettingsModal();
            });
            
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('closeSettings').addEventListener('click', function() {
                document.getElementById('settingsModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('settingsModal').style.display = 'none';
                }, 300);
            });
            
            // æœç´¢åŠŸèƒ½
            document.getElementById('toggleSearchBtn').addEventListener('click', function() {
                const searchBox = document.getElementById('searchBox');
                searchBox.style.display = searchBox.style.display === 'none' ? 'block' : 'none';
                if (searchBox.style.display === 'block') {
                    document.getElementById('searchInput').focus();
                }
            });
            
            document.getElementById('searchInput').addEventListener('input', function() {
                filterPassengers(this.value);
            });
            
            // æ‰¹é‡æ“ä½œåŠŸèƒ½
            document.getElementById('toggleBatchBtn').addEventListener('click', function() {
                const batchActions = document.getElementById('batchActions');
                const isVisible = batchActions.style.display === 'flex';
                batchActions.style.display = isVisible ? 'none' : 'flex';
                
                // åˆ‡æ¢å¤é€‰æ¡†æ˜¾ç¤º
                const checkboxes = document.querySelectorAll('.passenger-checkbox');
                checkboxes.forEach(cb => {
                    cb.style.display = isVisible ? 'none' : 'flex';
                });
            });
            
            document.getElementById('batchEditBtn').addEventListener('click', batchEditPassengers);
            document.getElementById('batchDeleteBtn').addEventListener('click', batchDeletePassengers);
            document.getElementById('cancelBatchBtn').addEventListener('click', function() {
                document.getElementById('batchActions').style.display = 'none';
                const checkboxes = document.querySelectorAll('.passenger-checkbox');
                checkboxes.forEach(cb => {
                    cb.style.display = 'none';
                });
                
                // å–æ¶ˆæ‰€æœ‰é€‰æ‹©
                document.querySelectorAll('.passenger-check').forEach(cb => {
                    cb.checked = false;
                });
            });
            
            // é«˜çº§å¼¹çª—äº‹ä»¶
            document.getElementById('cancelDelete').addEventListener('click', function() {
                document.getElementById('confirmDeleteModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('confirmDeleteModal').style.display = 'none';
                }, 300);
            });
            
            document.getElementById('confirmDelete').addEventListener('click', function() {
                performBatchDelete();
                document.getElementById('confirmDeleteModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('confirmDeleteModal').style.display = 'none';
                }, 300);
            });
            
            document.getElementById('closeSuccessModal').addEventListener('click', function() {
                document.getElementById('successModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('successModal').style.display = 'none';
                }, 300);
            });
            
            document.getElementById('closeErrorModal').addEventListener('click', function() {
                document.getElementById('errorModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('errorModal').style.display = 'none';
                }, 300);
            });
            
            // æ‰“å°åŠŸèƒ½
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // å¿«æ·é”®åŠŸèƒ½
            document.getElementById('shortcutsBtn').addEventListener('click', showKeyboardShortcuts);
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', function(e) {
                // Ctrl + Enter ç”Ÿæˆè¡¨å•
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('generateFormBtn').click();
                }
                
                // Ctrl + S ä¿å­˜æ•°æ®
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (settings.autoSave) {
                        saveToLocalStorage();
                        showAdvancedSuccess('æ•°æ®å·²è‡ªåŠ¨ä¿å­˜');
                    } else {
                        exportData();
                    }
                }
                
                // Ctrl + E å¯¼å‡ºExcel
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    if (document.getElementById('confirmPage').style.display === 'block') {
                        document.getElementById('confirmExport').click();
                    }
                }
                
                // Escape å…³é—­æ¨¡æ€çª—å£
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal, .advanced-modal');
                    modals.forEach(modal => {
                        if (modal.style.display === 'flex') {
                            modal.classList.remove('show');
                            setTimeout(() => {
                                modal.style.display = 'none';
                            }, 300);
                        }
                    });
                    
                    if (document.getElementById('confirmPage').style.display === 'block') {
                        document.getElementById('confirmPage').style.display = 'none';
                    }
                }
            });
            
            // æ·»åŠ æ“ä½œå†å²è®°å½•
            addToHistory('é¡µé¢åŠ è½½', { timestamp: new Date().toISOString() });
            
            // å…¨å±€é”™è¯¯å¤„ç†
            window.addEventListener('error', function(e) {
                console.error('å…¨å±€é”™è¯¯:', e.error);
                showAdvancedError('ç³»ç»Ÿå‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            });

            // æœªå¤„ç†çš„Promiseæ‹’ç»
            window.addEventListener('unhandledrejection', function(e) {
                console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
                showAdvancedError('æ“ä½œå¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®');
            });
        });
        
        // æ›´æ–°å­—ä½“å¤§å°
        function updateFontSize() {
            document.documentElement.style.setProperty('--font-size-base', fontSize + 'px');
            document.getElementById('fontSizeValue').textContent = fontSize;
        }
        
        // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
        function updateProgress(step) {
            for (let i = 1; i <= 3; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (i <= step) {
                    stepElement.classList.add('active');
                } else {
                    stepElement.classList.remove('active');
                }
            }
        }
        
        // ç¼–è¾‘ä¹˜æœºäººä¿¡æ¯
        function editPassenger(index) {
            const passengerItem = document.querySelector(`.passenger-item[data-index="${index}"]`);
            if (!passengerItem) return;
            
            const isForeign = passengerItem.classList.contains('foreign-passenger');
            const editBtn = passengerItem.querySelector('.edit-btn');
            const saveBtn = passengerItem.querySelector('.save-btn');
            
            if (isForeign) {
                // éèº«ä»½è¯ä¹˜å®¢ç¼–è¾‘æ¨¡å¼
                passengerItem.classList.add('editing');
                editBtn.style.display = 'none';
                saveBtn.style.display = 'block';
                
                // å¯ç”¨æ‰€æœ‰è¾“å…¥æ¡†å’Œé€‰æ‹©æ¡†
                const inputs = passengerItem.querySelectorAll('.document-form input, .document-form select');
                inputs.forEach(input => {
                    input.disabled = false;
                });
                
                // æ£€æŸ¥å¹¶æ›´æ–°å„¿ç«¥æç¤º
                updateChildWarning(passengerItem);
                
                // æ·»åŠ å‡ºç”Ÿæ—¥æœŸå˜åŒ–ç›‘å¬
                const birthDateInput = passengerItem.querySelector('.document-birthdate');
                if (birthDateInput) {
                    birthDateInput.addEventListener('input', function() {
                        updateChildWarning(passengerItem);
                    });
                }
            } else {
                // èº«ä»½è¯ä¹˜å®¢ç¼–è¾‘æ¨¡å¼
                const nameElement = passengerItem.querySelector('.passenger-name .value');
                const idElement = passengerItem.querySelector('.passenger-id .value');
                
                // åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼
                passengerItem.classList.add('editing');
                nameElement.setAttribute('contenteditable', 'true');
                idElement.setAttribute('contenteditable', 'true');
                editBtn.style.display = 'none';
                saveBtn.style.display = 'block';
                
                // èšç„¦åˆ°å§“åè¾“å…¥æ¡†
                nameElement.focus();
            }
        }
        
        // æ›´æ–°å„¿ç«¥æç¤º
        function updateChildWarning(passengerItem) {
            const birthDateInput = passengerItem.querySelector('.document-birthdate');
            const childWarning = passengerItem.querySelector('.child-warning');
            
            if (birthDateInput && childWarning) {
                const birthDate = birthDateInput.value;
                if (birthDate && calculatePassengerTypeByBirthDate(birthDate) === 'å„¿ç«¥') {
                    childWarning.style.display = 'flex';
                } else {
                    childWarning.style.display = 'none';
                }
            }
        }
        
        // ä¿å­˜ä¹˜æœºäººä¿¡æ¯
        function savePassenger(index) {
            const passengerItem = document.querySelector(`.passenger-item[data-index="${index}"]`);
            if (!passengerItem) return;
            
            const isForeign = passengerItem.classList.contains('foreign-passenger');
            const editBtn = passengerItem.querySelector('.edit-btn');
            const saveBtn = passengerItem.querySelector('.save-btn');
            
            if (isForeign) {
                // ä¿å­˜éèº«ä»½è¯ä¹˜å®¢ä¿¡æ¯
                const documentType = passengerItem.querySelector('.document-type').value;
                const documentNumber = passengerItem.querySelector('.document-number').value;
                const gender = passengerItem.querySelector('.document-gender').value;
                const birthDate = passengerItem.querySelector('.document-birthdate').value;
                const issueCountry = passengerItem.querySelector('.document-issue-country').value;
                const nationality = passengerItem.querySelector('.document-nationality').value;
                const documentExpiry = passengerItem.querySelector('.document-expiry').value;
                
                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!documentNumber) {
                    showAdvancedError('è¯ä»¶å·ç ä¸èƒ½ä¸ºç©º');
                    return;
                }
                
                if (!gender) {
                    showAdvancedError('è¯·é€‰æ‹©æ€§åˆ«');
                    return;
                }
                
                if (!birthDate) {
                    showAdvancedError('è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ');
                    return;
                }
                
                // éªŒè¯æ—¥æœŸæ ¼å¼
                if (!isValidDateFormat(birthDate)) {
                    showAdvancedError('å‡ºç”Ÿæ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨xxxx-yy-rræ ¼å¼ï¼Œä¾‹å¦‚2023-01-15');
                    return;
                }
                
                if (documentExpiry && !isValidDateFormat(documentExpiry)) {
                    showAdvancedError('è¯ä»¶æœ‰æ•ˆæœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨xxxx-yy-rræ ¼å¼ï¼Œä¾‹å¦‚2023-01-15');
                    return;
                }
                
                // æ›´æ–°ä¹˜å®¢æ•°æ®
                passengers[index].documentType = documentType;
                passengers[index].documentNumber = documentNumber;
                passengers[index].gender = gender;
                passengers[index].birthDate = birthDate;
                passengers[index].issueCountry = issueCountry;
                passengers[index].nationality = nationality;
                passengers[index].documentExpiry = documentExpiry;
                
                // ç¦ç”¨æ‰€æœ‰è¾“å…¥æ¡†å’Œé€‰æ‹©æ¡†
                const inputs = passengerItem.querySelectorAll('.document-form input, .document-form select');
                inputs.forEach(input => {
                    input.disabled = true;
                });
                
                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
                showAdvancedSuccess(`å·²æˆåŠŸä¿å­˜ä¹˜æœºäºº ${passengers[index].name} çš„è¯ä»¶ä¿¡æ¯`);
            } else {
                // ä¿å­˜èº«ä»½è¯ä¹˜å®¢ä¿¡æ¯
                const nameElement = passengerItem.querySelector('.passenger-name .value');
                const idElement = passengerItem.querySelector('.passenger-id .value');
                
                // è·å–ç¼–è¾‘åçš„å€¼
                const newName = nameElement.textContent.trim();
                const newId = idElement.textContent.trim();
                
                // éªŒè¯æ•°æ®
                if (!newName) {
                    showAdvancedError('å§“åä¸èƒ½ä¸ºç©º');
                    return;
                }
                
                // æ·»åŠ èº«ä»½è¯éªŒè¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (settings.validateId && !validateIdNumber(newId)) {
                    showAdvancedError('èº«ä»½è¯å·ç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥');
                    return;
                }
                
                if (!newId || (newId.length !== 15 && newId.length !== 18)) {
                    showAdvancedError('èº«ä»½è¯å·ç æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸º15ä½æˆ–18ä½');
                    return;
                }
                
                // æ›´æ–°ä¹˜å®¢æ•°æ®
                passengers[index].name = newName;
                passengers[index].idNumber = newId;
                
                // é€€å‡ºç¼–è¾‘æ¨¡å¼
                passengerItem.classList.remove('editing');
                nameElement.setAttribute('contenteditable', 'false');
                idElement.setAttribute('contenteditable', 'false');
                
                // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
                showAdvancedSuccess(`å·²æˆåŠŸä¿å­˜ä¹˜æœºäºº ${newName} çš„ä¿¡æ¯ï¼Œè¯·ä»”ç»†æ£€æŸ¥ä¿®æ”¹åçš„å†…å®¹`);
            }
            
            editBtn.style.display = 'block';
            saveBtn.style.display = 'none';
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // è‡ªåŠ¨ä¿å­˜ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (settings.autoSave) {
                saveToLocalStorage();
            }
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºæ‹¼éŸ³å§“åï¼ˆéä¸­æ–‡å­—ç¬¦ï¼‰
        function isPinyinName(name) {
            // åŒ¹é…ä¸­æ–‡å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼
            const chineseRegex = /[\u4e00-\u9fff]/;
            return !chineseRegex.test(name);
        }
        
        // éªŒè¯æ—¥æœŸæ ¼å¼æ˜¯å¦ä¸ºxxxx-yy-rr
        function isValidDateFormat(dateString) {
            if (!dateString) return true; // ç©ºå€¼å…è®¸é€šè¿‡
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            return regex.test(dateString);
        }
        
        // å®æ—¶æ›´æ–°è¯†åˆ«ç»“æœ
        function updateRealTimeResults() {
            const inputText = document.getElementById('passengerInput').value.trim();
            const resultsBody = document.getElementById('resultsBody');
            const realTimeResults = document.getElementById('realTimeResults');
            
            if (!inputText) {
                realTimeResults.style.display = 'none';
                document.getElementById('passengerCount').textContent = '0';
                updateStats();
                return;
            }
            
            const parsedPassengers = parsePassengerInfo(inputText);
            
            if (parsedPassengers.length === 0) {
                resultsBody.innerHTML = '<div class="no-passengers">æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„ä¹˜æœºäººä¿¡æ¯</div>';
                realTimeResults.style.display = 'block';
                document.getElementById('passengerCount').textContent = '0';
                updateStats();
                return;
            }
            
            // æ›´æ–°å…¨å±€ä¹˜å®¢æ•°æ®
            passengers = parsedPassengers;
            
            // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
            resultsBody.innerHTML = '';
            parsedPassengers.forEach((passenger, index) => {
                const passengerItem = document.createElement('div');
                passengerItem.className = `passenger-item ${passenger.isForeign ? 'foreign-passenger' : 'normal-passenger'} ${index % 2 === 0 ? 'highlight' : ''}`;
                passengerItem.setAttribute('data-index', index);
                
                if (passenger.isForeign) {
                    // éèº«ä»½è¯ä¹˜å®¢ï¼ˆæ‹¼éŸ³å§“åï¼‰
                    passengerItem.innerHTML = `
                        <div class="passenger-checkbox" style="display: none;">
                            <input type="checkbox" class="passenger-check" data-index="${index}">
                        </div>
                        <div class="passenger-info">
                            <div class="passenger-name">
                                <span class="label">å§“å:</span>
                                <span class="value" contenteditable="false">${passenger.name}</span>
                            </div>
                            <div class="passenger-document-info">
                                <div class="document-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>è¯ä»¶ç±»å‹:</label>
                                            <select class="document-type" data-index="${index}" disabled>
                                                <option value="æŠ¤ç…§" ${passenger.documentType === 'æŠ¤ç…§' ? 'selected' : ''}>æŠ¤ç…§</option>
                                                <option value="æ¸¯æ¾³å±…æ°‘æ¥å¾€å†…åœ°é€šè¡Œè¯" ${passenger.documentType === 'æ¸¯æ¾³å±…æ°‘æ¥å¾€å†…åœ°é€šè¡Œè¯' ? 'selected' : ''}>æ¸¯æ¾³å±…æ°‘æ¥å¾€å†…åœ°é€šè¡Œè¯</option>
                                                <option value="å°æ¹¾å±…æ°‘æ¥å¾€å¤§é™†é€šè¡Œè¯" ${passenger.documentType === 'å°æ¹¾å±…æ°‘æ¥å¾€å¤§é™†é€šè¡Œè¯' ? 'selected' : ''}>å°æ¹¾å±…æ°‘æ¥å¾€å¤§é™†é€šè¡Œè¯</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>è¯ä»¶å·ç :</label>
                                            <input type="text" class="document-number" data-index="${index}" value="${passenger.documentNumber}" placeholder="è¯·è¾“å…¥è¯ä»¶å·ç " disabled>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>æ€§åˆ«:</label>
                                            <select class="document-gender" data-index="${index}" disabled>
                                                <option value="ç”·" ${passenger.gender === 'ç”·' ? 'selected' : ''}>ç”·</option>
                                                <option value="å¥³" ${passenger.gender === 'å¥³' ? 'selected' : ''}>å¥³</option>
                                                <option value="æœªæŠ«éœ²æ€§åˆ«" ${passenger.gender === 'æœªæŠ«éœ²æ€§åˆ«' ? 'selected' : ''}>æœªæŠ«éœ²æ€§åˆ«</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>å‡ºç”Ÿæ—¥æœŸ:</label>
                                            <input type="text" class="document-birthdate" data-index="${index}" value="${passenger.birthDate}" placeholder="æ ¼å¼ï¼š2023-01-15" disabled>
                                            <div class="child-warning" style="display: none;">è¯·ç¡®è®¤æ˜¯å¦ä¸ºå„¿ç«¥æ—…å®¢</div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>ç­¾å‘å›½:</label>
                                            <input type="text" class="document-issue-country" data-index="${index}" value="${passenger.issueCountry}" placeholder="å¦‚: CN" disabled>
                                        </div>
                                        <div class="form-group">
                                            <label>å›½ç±:</label>
                                            <input type="text" class="document-nationality" data-index="${index}" value="${passenger.nationality}" placeholder="å¦‚: CN" disabled>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group full-width">
                                            <label>è¯ä»¶æœ‰æ•ˆæœŸ:</label>
                                            <input type="text" class="document-expiry" data-index="${index}" value="${passenger.documentExpiry}" placeholder="æ ¼å¼ï¼š2023-01-15" disabled>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="passenger-actions">
                            <button class="btn-small btn-primary edit-btn" data-index="${index}">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button class="btn-small btn-success save-btn" data-index="${index}" style="display: none;">
                                <i class="fas fa-save"></i> ä¿å­˜
                            </button>
                        </div>
                    `;
                } else {
                    // èº«ä»½è¯ä¹˜å®¢
                    passengerItem.innerHTML = `
                        <div class="passenger-checkbox" style="display: none;">
                            <input type="checkbox" class="passenger-check" data-index="${index}">
                        </div>
                        <div class="passenger-info">
                            <div class="passenger-name">
                                <span class="label">å§“å:</span>
                                <span class="value" contenteditable="false">${passenger.name}</span>
                            </div>
                            <div class="passenger-id">
                                <span class="label">èº«ä»½è¯:</span>
                                <span class="value" contenteditable="false">${passenger.idNumber}</span>
                            </div>
                        </div>
                        <div class="passenger-actions">
                            <button class="btn-small btn-primary edit-btn" data-index="${index}">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button class="btn-small btn-success save-btn" data-index="${index}" style="display: none;">
                                <i class="fas fa-save"></i> ä¿å­˜
                            </button>
                        </div>
                    `;
                }
                
                resultsBody.appendChild(passengerItem);
            });
            
            realTimeResults.style.display = 'block';
            document.getElementById('passengerCount').textContent = parsedPassengers.length;
            updateStats();
            
            // è‡ªåŠ¨ä¿å­˜ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (settings.autoSave) {
                saveToLocalStorage();
            }
        }
        
        // ç”Ÿæˆè¡¨å•
        document.getElementById('generateFormBtn').addEventListener('click', function() {
            const inputText = document.getElementById('passengerInput').value.trim();
            if (!inputText) {
                showAdvancedError('è¯·è¾“å…¥ä¹˜æœºäººä¿¡æ¯');
                return;
            }
            
            // å¦‚æœæœ‰ä¹˜å®¢æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨ï¼ˆå¯èƒ½å·²ç¼–è¾‘è¿‡ï¼‰
            if (passengers.length === 0) {
                showAdvancedError('æ— æ³•è¯†åˆ«ä¹˜æœºäººä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰éèº«ä»½è¯ä¹˜å®¢æœªå¡«å†™å®Œæ•´ä¿¡æ¯
            const incompleteForeignPassengers = passengers.filter(p => 
                p.isForeign && (!p.documentNumber || !p.gender || !p.birthDate)
            );
            
            if (incompleteForeignPassengers.length > 0) {
                // æ˜¾ç¤ºæé†’å¼¹çª—
                showForeignPassengerAlert(incompleteForeignPassengers);
                return;
            }
            
            // æ¸…ç©ºæ‰‹æœºå·ç è¾“å…¥æ¡†
            document.getElementById('phoneInput').value = '';
            
            // æ˜¾ç¤ºæ‰‹æœºå·ç å¼¹çª—
            document.getElementById('phoneModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('phoneModal').classList.add('show');
            }, 10);
            
            updateProgress(2);
        });
        
        // æ˜¾ç¤ºéèº«ä»½è¯ä¹˜å®¢æé†’å¼¹çª—
        function showForeignPassengerAlert(incompletePassengers) {
            const alertModal = document.createElement('div');
            alertModal.className = 'modal';
            alertModal.id = 'foreignAlertModal';
            alertModal.style.display = 'flex';
            
            alertModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">æç¤ºï¼šéèº«ä»½è¯ä¹˜æœºäººä¿¡æ¯ä¸å®Œæ•´</div>
                    <div class="modal-body">
                        <p style="margin-bottom: 15px; color: #666; line-height: 1.5;">
                            æ£€æµ‹åˆ° ${incompletePassengers.length} ä½ä½¿ç”¨æŠ¤ç…§æˆ–é€šè¡Œè¯çš„ä¹˜æœºäººä¿¡æ¯ä¸å®Œæ•´ï¼š
                        </p>
                        <ul style="margin-bottom: 20px; padding-left: 20px;">
                            ${incompletePassengers.map(p => `<li>${p.name}</li>`).join('')}
                        </ul>
                        <p style="margin-bottom: 15px; color: #666; line-height: 1.5;">
                            æ‚¨å¯ä»¥é€‰æ‹©ï¼š
                        </p>
                        <div class="input-hint">
                            <strong>é€‰é¡¹1ï¼š</strong> è¿”å›å®Œå–„è¯ä»¶ä¿¡æ¯ï¼ˆæ¨èï¼‰
                        </div>
                        <div class="input-hint">
                            <strong>é€‰é¡¹2ï¼š</strong> ç»§ç»­ç”Ÿæˆè¡¨å•ï¼Œåœ¨è¡¨æ ¼ä¸­æ‰‹åŠ¨å¡«å†™
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="cancelForeignAlert" class="btn-secondary">
                            <i class="fas fa-edit"></i> è¿”å›å®Œå–„
                        </button>
                        <button id="continueToForm" class="btn-primary">
                            <i class="fas fa-arrow-right"></i> ç»§ç»­ç”Ÿæˆè¡¨å•
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(alertModal);
            
            setTimeout(() => {
                alertModal.classList.add('show');
            }, 10);
            
            // äº‹ä»¶å¤„ç†
            document.getElementById('cancelForeignAlert').addEventListener('click', function() {
                alertModal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(alertModal);
                }, 300);
            });
            
            document.getElementById('continueToForm').addEventListener('click', function() {
                alertModal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(alertModal);
                    
                    // æ¸…ç©ºæ‰‹æœºå·ç è¾“å…¥æ¡†
                    document.getElementById('phoneInput').value = '';
                    
                    // æ˜¾ç¤ºæ‰‹æœºå·ç å¼¹çª—
                    document.getElementById('phoneModal').style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('phoneModal').classList.add('show');
                    }, 10);
                    
                    updateProgress(2);
                }, 300);
            });
        }
        
        // ç¡®è®¤æ‰‹æœºå·ç 
        document.getElementById('confirmPhone').addEventListener('click', function() {
            currentPhone = document.getElementById('phoneInput').value.trim();
            if (!currentPhone) {
                showAdvancedError('è¯·è¾“å…¥ä¹˜æœºäººè®¢å•é¢„ç•™å·ç ');
                return;
            }
            
            if (!/^1[3-9]\d{9}$/.test(currentPhone)) {
                showAdvancedError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç æ ¼å¼');
                return;
            }
            
            // å…³é—­å¼¹çª—
            document.getElementById('phoneModal').classList.remove('show');
            setTimeout(() => {
                document.getElementById('phoneModal').style.display = 'none';
            }, 300);
            
            // æ˜¾ç¤ºç¡®è®¤é¡µé¢
            showConfirmPage();
            updateProgress(3);
        });
        
        // å–æ¶ˆæ‰‹æœºå·ç è¾“å…¥
        document.getElementById('cancelPhone').addEventListener('click', function() {
            document.getElementById('phoneModal').classList.remove('show');
            setTimeout(() => {
                document.getElementById('phoneModal').style.display = 'none';
            }, 300);
        });
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('clearInputBtn').addEventListener('click', function() {
            document.getElementById('passengerInput').value = '';
            updateRealTimeResults();
        });
        
        // æ˜¾ç¤ºç¤ºä¾‹
        document.getElementById('exampleBtn').addEventListener('click', function() {
            const exampleText = `ä¹˜æœºäººï¼šå¼ ä¸‰ 
èº«ä»½è¯ï¼š110101199001011234 
ç¥¨å·ï¼š8592172332735 
èˆªç­å·ï¼š8L9826 
èµ·é™åœ°ï¼šæ­¦æ±‰å¤©æ²³æœºåœºT2-ä¸½æ±Ÿä¸‰ä¹‰æœºåœº 
èµ·é£æ—¶é—´ï¼š2025-10-12 10:30-12:45

ä¹˜æœºäººï¼šæå›› 
èº«ä»½è¯ï¼š110101199001011235 
ç¥¨å·ï¼š8592172332736 
èˆªç­å·ï¼š8L9826 
èµ·é™åœ°ï¼šæ­¦æ±‰å¤©æ²³æœºåœºT2-ä¸½æ±Ÿä¸‰ä¹‰æœºåœº 
èµ·é£æ—¶é—´ï¼š2025-10-12 10:30-12:45`;
            
            document.getElementById('passengerInput').value = exampleText;
            updateRealTimeResults();
        });
        
        // å…³é—­ç¡®è®¤é¡µé¢
        document.getElementById('closeConfirm').addEventListener('click', function() {
            document.getElementById('confirmPage').style.display = 'none';
        });
        
        // è¿”å›ä¿®æ”¹
        document.getElementById('backToEdit').addEventListener('click', function() {
            document.getElementById('confirmPage').style.display = 'none';
            // ç›´æ¥è¿”å›ä¸»é¡µé¢ï¼Œä¸æ˜¾ç¤ºæ‰‹æœºå·ç å¼¹çª—
            updateProgress(1);
        });
        
        // ç¡®è®¤å¯¼å‡º
        document.getElementById('confirmExport').addEventListener('click', function() {
            // æ”¶é›†è¡¨æ ¼ä¸­æ‰€æœ‰ä¿®æ”¹åçš„æ•°æ®
            const updatedPassengers = collectTableData();
            
            // éªŒè¯å…³é”®æ•°æ®
            let hasErrors = false;
            updatedPassengers.forEach((passenger, index) => {
                if (!passenger.name) {
                    showAdvancedError(`ç¬¬${index + 1}è¡Œä¹˜æœºäººå§“åä¸èƒ½ä¸ºç©º`);
                    hasErrors = true;
                }
                if (!passenger.idNumber) {
                    showAdvancedError(`ç¬¬${index + 1}è¡Œè¯ä»¶å·ç ä¸èƒ½ä¸ºç©º`);
                    hasErrors = true;
                }
            });
            
            if (hasErrors) {
                return;
            }
            
            // ä½¿ç”¨ä¿®æ”¹åçš„æ•°æ®ç”ŸæˆExcel
            generateExcelFile(updatedPassengers);
            showAdvancedSuccess('Excelæ–‡ä»¶å·²æˆåŠŸç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½ï¼');
            document.getElementById('confirmPage').style.display = 'none';
        });
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            successElement.textContent = message;
            successElement.style.display = 'flex';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'flex';
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }
        
        // æ˜¾ç¤ºé«˜çº§æˆåŠŸå¼¹çª—
        function showAdvancedSuccess(message) {
            document.getElementById('successModalText').textContent = message;
            document.getElementById('successModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('successModal').classList.add('show');
            }, 10);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                document.getElementById('successModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('successModal').style.display = 'none';
                }, 300);
            }, 3000);
        }
        
        // æ˜¾ç¤ºé«˜çº§é”™è¯¯å¼¹çª—
        function showAdvancedError(message) {
            document.getElementById('errorModalText').textContent = message;
            document.getElementById('errorModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('errorModal').classList.add('show');
            }, 10);
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                document.getElementById('errorModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('errorModal').style.display = 'none';
                }, 300);
            }, 5000);
        }
        
        // æ˜¾ç¤ºç¡®è®¤é¡µé¢
        function showConfirmPage() {
            // æ¸²æŸ“è¡¨æ ¼
            renderTable();
            
            // æ˜¾ç¤ºç¡®è®¤é¡µé¢
            document.getElementById('confirmPage').style.display = 'block';
        }
        
        // è§£æä¹˜æœºäººä¿¡æ¯å‡½æ•°
        function parsePassengerInfo(text) {
            const passengers = [];
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            // æå–èˆªç­ä¿¡æ¯
            let flightNumber = '';
            let route = '';
            let flightTime = '';
            
            for (const line of lines) {
                if (line.startsWith('èˆªç­å·ï¼š')) {
                    flightNumber = line.replace('èˆªç­å·ï¼š', '');
                } else if (line.startsWith('èµ·é™åœ°ï¼š')) {
                    route = line.replace('èµ·é™åœ°ï¼š', '');
                } else if (line.startsWith('èµ·é£æ—¶é—´ï¼š')) {
                    flightTime = line.replace('èµ·é£æ—¶é—´ï¼š', '');
                }
            }
            
            // è§£æä¹˜æœºäººä¿¡æ¯
            let currentPassenger = null;
            
            for (const line of lines) {
                if (line.startsWith('ä¹˜æœºäºº') || line.startsWith('ä¹˜æœºäººï¼š')) {
                    // ä¿å­˜ä¸Šä¸€ä¸ªä¹˜æœºäºº
                    if (currentPassenger) {
                        passengers.push(currentPassenger);
                    }
                    
                    // åˆ›å»ºæ–°ä¹˜æœºäºº
                    const name = line.includes('ï¼š') ? line.split('ï¼š')[1] : line.replace('ä¹˜æœºäºº', '');
                    const isForeign = isPinyinName(name.trim());
                    
                    currentPassenger = {
                        name: name.trim(),
                        idNumber: '',
                        ticketNumber: '',
                        flightNumber: flightNumber,
                        route: route,
                        flightTime: flightTime,
                        isForeign: isForeign,
                        // éèº«ä»½è¯è¯ä»¶ä¿¡æ¯
                        documentType: isForeign ? 'æŠ¤ç…§' : '',
                        documentNumber: '',
                        gender: '',
                        birthDate: '',
                        issueCountry: '',
                        nationality: '',
                        documentExpiry: ''
                    };
                } else if (line.startsWith('èº«ä»½è¯ï¼š') && currentPassenger && !currentPassenger.isForeign) {
                    currentPassenger.idNumber = line.replace('èº«ä»½è¯ï¼š', '');
                } else if (line.startsWith('ç¥¨å·ï¼š') && currentPassenger) {
                    currentPassenger.ticketNumber = line.replace('ç¥¨å·ï¼š', '');
                }
            }
            
            // æ·»åŠ æœ€åä¸€ä¸ªä¹˜æœºäºº
            if (currentPassenger) {
                passengers.push(currentPassenger);
            }
            
            return passengers;
        }
        
        // æ ¹æ®èº«ä»½è¯è®¡ç®—å¹´é¾„
        function calculateAge(idNumber) {
            if (!idNumber) return 'æˆäºº';
            
            let birthYear, birthMonth, birthDay;
            
            // å¤„ç†15ä½èº«ä»½è¯
            if (idNumber.length === 15) {
                birthYear = parseInt('19' + idNumber.substring(6, 8));
                birthMonth = parseInt(idNumber.substring(8, 10)) - 1;
                birthDay = parseInt(idNumber.substring(10, 12));
            } 
            // å¤„ç†18ä½èº«ä»½è¯
            else if (idNumber.length === 18) {
                birthYear = parseInt(idNumber.substring(6, 10));
                birthMonth = parseInt(idNumber.substring(10, 12)) - 1;
                birthDay = parseInt(idNumber.substring(12, 14));
            } else {
                return 'æˆäºº';
            }
            
            const birthDate = new Date(birthYear, birthMonth, birthDay);
            const today = new Date();
            
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            if (age < 2) {
                return 'å©´å„¿';
            } else if (age < 12) {
                return 'å„¿ç«¥';
            } else {
                return 'æˆäºº';
            }
        }
        
        // æ ¹æ®å‡ºç”Ÿæ—¥æœŸè®¡ç®—ä¹˜å®¢ç±»å‹
        function calculatePassengerTypeByBirthDate(birthDate) {
            if (!birthDate) return 'æˆäºº';
            
            // è§£æå‡ºç”Ÿæ—¥æœŸ
            const parts = birthDate.split('-');
            if (parts.length !== 3) return 'æˆäºº';
            
            const birthYear = parseInt(parts[0]);
            const birthMonth = parseInt(parts[1]) - 1;
            const birthDay = parseInt(parts[2]);
            
            const birthDateObj = new Date(birthYear, birthMonth, birthDay);
            const today = new Date();
            
            let age = today.getFullYear() - birthDateObj.getFullYear();
            const monthDiff = today.getMonth() - birthDateObj.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDateObj.getDate())) {
                age--;
            }
            
            if (age < 2) {
                return 'å©´å„¿';
            } else if (age < 12) {
                return 'å„¿ç«¥';
            } else {
                return 'æˆäºº';
            }
        }
        
        // æ ¹æ®èº«ä»½è¯åˆ¤æ–­æ€§åˆ«
        function getGender(idNumber) {
            if (!idNumber) return '';
            
            let genderCode;
            
            // å¤„ç†15ä½èº«ä»½è¯
            if (idNumber.length === 15) {
                genderCode = parseInt(idNumber.charAt(14));
            } 
            // å¤„ç†18ä½èº«ä»½è¯
            else if (idNumber.length === 18) {
                genderCode = parseInt(idNumber.charAt(16));
            } else {
                return '';
            }
            
            return genderCode % 2 === 0 ? 'å¥³' : 'ç”·';
        }
        
        // ä»èº«ä»½è¯æå–å‡ºç”Ÿæ—¥æœŸ
        function getBirthDate(idNumber) {
            if (!idNumber) return '';
            
            let year, month, day;
            
            // å¤„ç†15ä½èº«ä»½è¯
            if (idNumber.length === 15) {
                year = '19' + idNumber.substring(6, 8);
                month = idNumber.substring(8, 10);
                day = idNumber.substring(10, 12);
            } 
            // å¤„ç†18ä½èº«ä»½è¯
            else if (idNumber.length === 18) {
                year = idNumber.substring(6, 10);
                month = idNumber.substring(10, 12);
                day = idNumber.substring(12, 14);
            } else {
                return '';
            }
            
            return `${year}-${month}-${day}`;
        }
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const table = document.getElementById('passengerTable');
            table.innerHTML = '';
            
            // æ›´æ–°ä¹˜æœºäººè®¡æ•°
            document.getElementById('passengerCount').textContent = passengers.length;
            
            // åˆ›å»ºæ ·ä¾‹åŒºåŸŸæ ‡é¢˜è¡Œ
            const exampleTitleRow = document.createElement('tr');
            exampleTitleRow.innerHTML = `
                <td colspan="25" class="section-title">æ ·ä¾‹åŒºåŸŸ æ­¤è¡Œä¸ºå¡«å†™æ ·ä¾‹ï¼ŒæŒ‡å¯¼ç»åŠäººå¡«å†™è¡¨æ ¼ã€‚</td>
            `;
            table.appendChild(exampleTitleRow);
            
            // åˆ›å»ºè¡¨å¤´ç¬¬ä¸€è¡Œ
            const headerRow1 = document.createElement('tr');
            headerRow1.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">åºå·ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-C">æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-D">ç§°è°“</td>
                <td class="col-E">æ—…å®¢å§“ï¼ˆ*å¿…å¡«ï¼‰<br><span class="info-text">ï¼ˆè¯ä»¶ä¿¡æ¯éå±…æ°‘èº«ä»½è¯ã€æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ã€æ— æ³•è¯†åˆ«è¯ä»¶æ—¶å¿…é¡»å¡«å†™è‹±æ–‡å§“åï¼‰</span></td>
                <td class="col-F">æ‰‹æœºå·å‰ç¼€</td>
                <td class="col-G">æ‰‹æœºå·</td>
                <td class="col-H">é‚®ç®±</td>
                <td colspan="2" class="group-title">è¯ä»¶ä¿¡æ¯</td>
                <td colspan="5" class="group-title">è¯ä»¶è¡¥å……ä¿¡æ¯</td>
                <td colspan="5" class="group-title">å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œå‡ºå‘åœ°åœ°å€</td>
                <td colspan="5" class="group-title">å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œç›®çš„åœ°åœ°å€</td>
            `;
            table.appendChild(headerRow1);
            
            // åˆ›å»ºè¡¨å¤´ç¬¬äºŒè¡Œ
            const headerRow2 = document.createElement('tr');
            headerRow2.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">åºå·ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-C">æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-D">ç§°è°“</td>
                <td class="col-E">æ—…å®¢å§“ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-F">æ‰‹æœºå·å‰ç¼€</td>
                <td class="col-G">æ‰‹æœºå·</td>
                <td class="col-H">é‚®ç®±</td>
                <td class="col-I">è¯ä»¶ç±»å‹ï¼ˆèº«ä»½è¯ã€æŠ¤ç…§ç­‰ï¼‰</td>
                <td class="col-J">è¯ä»¶å·ç </td>
                <td class="col-K">æ€§åˆ«</td>
                <td class="col-L">å‡ºç”Ÿæ—¥æœŸ</td>
                <td class="col-M">ç­¾å‘å›½ï¼ˆå›½å®¶/åœ°åŒºäºŒå­—ç ï¼‰</td>
                <td class="col-N">å›½ç±ï¼ˆå›½å®¶/åœ°åŒºäºŒå­—ç ï¼‰</td>
                <td class="col-O">è¯ä»¶æœ‰æ•ˆæœŸ</td>
                <td class="col-P">å›½å®¶Country</td>
                <td class="col-Q">çœ/å·State</td>
                <td class="col-R">åŸå¸‚City</td>
                <td class="col-S">åœ°å€Address</td>
                <td class="col-T">é‚®ç¼–Zip</td>
                <td class="col-U">å›½å®¶Country</td>
                <td class="col-V">çœ/å·State</td>
                <td class="col-W">åŸå¸‚City</td>
                <td class="col-X">åœ°å€Address</td>
                <td class="col-Y">é‚®ç¼–Zip</td>
            `;
            table.appendChild(headerRow2);
            
            // æ·»åŠ ç¤ºä¾‹è¡Œ
            const exampleRow1 = document.createElement('tr');
            exampleRow1.className = 'example-row';
            exampleRow1.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">1</td>
                <td class="col-C">æˆäºº</td>
                <td class="col-D">SD ç•™å­¦ç”Ÿ</td>
                <td class="col-E">ç‹æˆäººä¸€</td>
                <td class="col-F">86</td>
                <td class="col-G">16666666666</td>
                <td class="col-H">123@qq.com</td>
                <td class="col-I">å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI</td>
                <td class="col-J">11010319950509XXXX</td>
                <td class="col-K">ç”·</td>
                <td class="col-L"></td>
                <td class="col-M"></td>
                <td class="col-N"></td>
                <td class="col-O"></td>
                <td class="col-P">USA</td>
                <td class="col-Q">CA</td>
                <td class="col-R">Los Angeles</td>
                <td class="col-S">137 San rdino Rd</td>
                <td class="col-T">91723</td>
                <td class="col-U">USA</td>
                <td class="col-V">CA</td>
                <td class="col-W">Los Angeles</td>
                <td class="col-X">137 San rdino Rd</td>
                <td class="col-Y">91723</td>
            `;
            table.appendChild(exampleRow1);
            
            const exampleRow2 = document.createElement('tr');
            exampleRow2.className = 'example-row';
            exampleRow2.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">2</td>
                <td class="col-C">æˆäºº</td>
                <td class="col-D">SD ç•™å­¦ç”Ÿ</td>
                <td class="col-E">TEST/ONE</td>
                <td class="col-F">86</td>
                <td class="col-G">16666666666</td>
                <td class="col-H">123@qq.com</td>
                <td class="col-I">å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI</td>
                <td class="col-J">11010120150307XXXX</td>
                <td class="col-K">ç”·</td>
                <td class="col-L">2015-03-07 00:00:00</td>
                <td class="col-M">CN</td>
                <td class="col-N">CN</td>
                <td class="col-O">2025-10-01 00:00:00</td>
                <td class="col-P">USA</td>
                <td class="col-Q">CA</td>
                <td class="col-R">Los Angeles</td>
                <td class="col-S">137 San rdino Rd</td>
                <td class="col-T">91723</td>
                <td class="col-U">USA</td>
                <td class="col-V">CA</td>
                <td class="col-W">Los Angeles</td>
                <td class="col-X">137 San rdino Rd</td>
                <td class="col-Y">91723</td>
            `;
            table.appendChild(exampleRow2);
            
            // æ·»åŠ ç©ºè¡Œå’Œæç¤ºè¡Œ
            const emptyRow1 = document.createElement('tr');
            emptyRow1.className = 'empty-row';
            emptyRow1.innerHTML = `<td colspan="25"></td>`;
            table.appendChild(emptyRow1);
            
            const emptyRow2 = document.createElement('tr');
            emptyRow2.className = 'empty-row';
            emptyRow2.innerHTML = `<td colspan="25"></td>`;
            table.appendChild(emptyRow2);
            
            const warningRow = document.createElement('tr');
            warningRow.className = 'warning-row';
            warningRow.innerHTML = `<td colspan="25">æ¸©é¦¨æç¤ºï¼šè¯·ä¸è¦ä¿®æ”¹æ¨¡æ¿</td>`;
            table.appendChild(warningRow);
            
            // åˆ›å»ºæ‰¹é‡å¡«å†™åŒºåŸŸæ ‡é¢˜è¡Œ
            const batchTitleRow = document.createElement('tr');
            batchTitleRow.innerHTML = `<td colspan="25" class="section-title">æ‰¹é‡å¡«å†™åŒºåŸŸ è¯·ç»åŠäººåœ¨æ­¤åŒºåŸŸå¡«å†™è¡¨æ ¼ã€‚</td>`;
            table.appendChild(batchTitleRow);
            
            // åˆ›å»ºè¡¨å¤´ç¬¬ä¸€è¡Œ
            const batchHeaderRow1 = document.createElement('tr');
            batchHeaderRow1.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">åºå·ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-C">æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-D">ç§°è°“</td>
                <td class="col-E">æ—…å®¢å§“åï¼ˆ*å¿…å¡«ï¼‰<br><span class="info-text">ï¼ˆè¯ä»¶ä¿¡æ¯éå±…æ°‘èº«ä»½è¯ã€æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ã€æ— æ³•è¯†åˆ«è¯ä»¶æ—¶å¿…é¡»å¡«å†™è‹±æ–‡å§“åï¼‰</span></td>
                <td class="col-F">æ‰‹æœºå·å‰ç¼€</td>
                <td class="col-G">æ‰‹æœºå·</td>
                <td class="col-H">é‚®ç®±</td>
                <td colspan="2" class="group-title">è¯ä»¶ä¿¡æ¯</td>
                <td colspan="5" class="group-title">è¯ä»¶è¡¥å……ä¿¡æ¯</td>
                <td colspan="5" class="group-title">å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œå‡ºå‘åœ°åœ°å€</td>
                <td colspan="5" class="group-title">å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œç›®çš„åœ°åœ°å€</td>
            `;
            table.appendChild(batchHeaderRow1);
            
            // åˆ›å»ºè¡¨å¤´ç¬¬äºŒè¡Œ
            const batchHeaderRow2 = document.createElement('tr');
            batchHeaderRow2.innerHTML = `
                <td class="col-A"></td>
                <td class="col-B">åºå·ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-C">æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-D">ç§°è°“</td>
                <td class="col-E">æ—…å®¢å§“åï¼ˆ*å¿…å¡«ï¼‰</td>
                <td class="col-F">æ‰‹æœºå·å‰ç¼€</td>
                <td class="col-G">æ‰‹æœºå·</td>
                <td class="col-H">é‚®ç®±</td>
                <td class="col-I">è¯ä»¶ç±»å‹ï¼ˆèº«ä»½è¯ã€æŠ¤ç…§ç­‰ï¼‰</td>
                <td class="col-J">è¯ä»¶å·ç </td>
                <td class="col-K">æ€§åˆ«</td>
                <td class="col-L">å‡ºç”Ÿæ—¥æœŸ</td>
                <td class="col-M">ç­¾å‘å›½ï¼ˆå›½å®¶/åœ°åŒºï¼‰</td>
                <td class="col-N">å›½ç±ï¼ˆå›½å®¶/åœ°åŒºï¼‰</td>
                <td class="col-O">è¯ä»¶æœ‰æ•ˆæœŸ</td>
                <td class="col-P">å›½å®¶Country</td>
                <td class="col-Q">çœ/å·State</td>
                <td class="col-R">åŸå¸‚City</td>
                <td class="col-S">åœ°å€Address</td>
                <td class="col-T">é‚®ç¼–Zip</td>
                <td class="col-U">å›½å®¶Country</td>
                <td class="col-V">çœ/å·State</td>
                <td class="col-W">åŸå¸‚City</td>
                <td class="col-X">åœ°å€Address</td>
                <td class="col-Y">é‚®ç¼–Zip</td>
            `;
            table.appendChild(batchHeaderRow2);
            
            // æ·»åŠ ä¹˜æœºäººæ•°æ®è¡Œ
            passengers.forEach((passenger, index) => {
                const row = document.createElement('tr');
                row.className = 'editable-row';
                
                let passengerType, gender, birthDate, idType, idNumber;
                
                if (passenger.isForeign) {
                    // éèº«ä»½è¯ä¹˜å®¢ - æ ¹æ®å‡ºç”Ÿæ—¥æœŸè®¡ç®—ä¹˜å®¢ç±»å‹
                    passengerType = calculatePassengerTypeByBirthDate(passenger.birthDate);
                    gender = passenger.gender || '';
                    birthDate = passenger.birthDate || '';
                    idType = passenger.documentType || 'æŠ¤ç…§';
                    idNumber = passenger.documentNumber || '';
                } else {
                    // èº«ä»½è¯ä¹˜å®¢
                    passengerType = calculateAge(passenger.idNumber);
                    gender = getGender(passenger.idNumber);
                    birthDate = getBirthDate(passenger.idNumber);
                    idType = 'å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI';
                    idNumber = passenger.idNumber || '';
                }
                
                row.innerHTML = `
                    <td class="col-A"></td>
                    <td class="col-B editable-cell"><input type="text" value="${index + 1}" data-field="index"></td>
                    <td class="col-C editable-cell">
                        <select data-field="passengerType">
                            <option value="æˆäºº" ${passengerType === 'æˆäºº' ? 'selected' : ''}>æˆäºº</option>
                            <option value="å„¿ç«¥" ${passengerType === 'å„¿ç«¥' ? 'selected' : ''}>å„¿ç«¥</option>
                            <option value="å©´å„¿" ${passengerType === 'å©´å„¿' ? 'selected' : ''}>å©´å„¿</option>
                        </select>
                    </td>
                    <td class="col-D editable-cell"><input type="text" value="" data-field="title"></td>
                    <td class="col-E editable-cell"><input type="text" value="${passenger.name}" data-field="name"></td>
                    <td class="col-F editable-cell"><input type="text" value="${settings.defaultPhonePrefix}" data-field="phonePrefix"></td>
                    <td class="col-G editable-cell"><input type="text" value="${currentPhone}" data-field="phone"></td>
                    <td class="col-H editable-cell"><input type="text" value="" data-field="email"></td>
                    <td class="col-I editable-cell">
                        <select data-field="idType">
                            <option value="å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI" ${idType === 'å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI' ? 'selected' : ''}>å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI</option>
                            <option value="æŠ¤ç…§ DOCS P" ${idType === 'æŠ¤ç…§' ? 'selected' : ''}>æŠ¤ç…§ DOCS P</option>
                            <option value="æ¸¯æ¾³å±…æ°‘å¾€æ¥å†…åœ°é€šè¡Œè¯ / å°æ¹¾å±…æ°‘å¾€æ¥å¤§é™†é€šè¡Œè¯ DOCS A" ${idType === 'æ¸¯æ¾³å±…æ°‘æ¥å¾€å†…åœ°é€šè¡Œè¯' || idType === 'å°æ¹¾å±…æ°‘æ¥å¾€å¤§é™†é€šè¡Œè¯' ? 'selected' : ''}>æ¸¯æ¾³å±…æ°‘å¾€æ¥å†…åœ°é€šè¡Œè¯ / å°æ¹¾å±…æ°‘å¾€æ¥å¤§é™†é€šè¡Œè¯ DOCS A</option>
                        </select>
                    </td>
                    <td class="col-J editable-cell"><input type="text" value="${idNumber}" data-field="idNumber"></td>
                    <td class="col-K editable-cell">
                        <select data-field="gender">
                            <option value="ç”·" ${gender === 'ç”·' ? 'selected' : ''}>ç”·</option>
                            <option value="å¥³" ${gender === 'å¥³' ? 'selected' : ''}>å¥³</option>
                            <option value="æœªæŠ«éœ²æ€§åˆ«" ${gender === 'æœªæŠ«éœ²æ€§åˆ«' ? 'selected' : ''}>æœªæŠ«éœ²æ€§åˆ«</option>
                        </select>
                    </td>
                    <td class="col-L editable-cell"><input type="text" value="${birthDate}" data-field="birthDate"></td>
                    <td class="col-M editable-cell"><input type="text" value="${passenger.issueCountry || ''}" data-field="issueCountry"></td>
                    <td class="col-N editable-cell"><input type="text" value="${passenger.nationality || ''}" data-field="nationality"></td>
                    <td class="col-O editable-cell"><input type="text" value="${passenger.documentExpiry || ''}" data-field="idExpiry"></td>
                    <td class="col-P editable-cell"><input type="text" value="" data-field="departureCountry"></td>
                    <td class="col-Q editable-cell"><input type="text" value="" data-field="departureState"></td>
                    <td class="col-R editable-cell"><input type="text" value="" data-field="departureCity"></td>
                    <td class="col-S editable-cell"><input type="text" value="" data-field="departureAddress"></td>
                    <td class="col-T editable-cell"><input type="text" value="" data-field="departureZip"></td>
                    <td class="col-U editable-cell"><input type="text" value="" data-field="arrivalCountry"></td>
                    <td class="col-V editable-cell"><input type="text" value="" data-field="arrivalState"></td>
                    <td class="col-W editable-cell"><input type="text" value="" data-field="arrivalCity"></td>
                    <td class="col-X editable-cell"><input type="text" value="" data-field="arrivalAddress"></td>
                    <td class="col-Y editable-cell"><input type="text" value="" data-field="arrivalZip"></td>
                `;
                table.appendChild(row);
            });
            
            // æ·»åŠ ç©ºè¡Œä»¥ä¿æŒæ¨¡æ¿ç»“æ„
            for (let i = passengers.length; i < 6; i++) {
                const emptyRow = document.createElement('tr');
                emptyRow.className = 'empty-row';
                emptyRow.innerHTML = `<td colspan="25"></td>`;
                table.appendChild(emptyRow);
            }
        }
        
        // æ”¶é›†è¡¨æ ¼æ•°æ® - ä¿®å¤ç‰ˆæœ¬
        function collectTableData() {
            const rows = document.querySelectorAll('.editable-row');
            const updatedPassengers = [];
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input, select');
                const passenger = {};
                
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    passenger[field] = input.value;
                });
                
                // æ·»åŠ åŸå§‹çš„ä¹˜å®¢ä¿¡æ¯ï¼ˆå¦‚ç¥¨å·ã€èˆªç­ä¿¡æ¯ç­‰ï¼‰
                const index = parseInt(row.querySelector('input[data-field="index"]').value) - 1;
                if (passengers[index]) {
                    passenger.originalData = passengers[index];
                }
                
                updatedPassengers.push(passenger);
            });
            
            return updatedPassengers;
        }
        
        // ç”ŸæˆExcelæ–‡ä»¶ - ä¿®å¤ç‰ˆæœ¬
        function generateExcelFile(passengerData) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            try {
                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                
                // åˆ›å»º"ä¸´æ—¶è®¢å•"å·¥ä½œè¡¨
                const tempOrderData = [
                    ["æ ·ä¾‹åŒºåŸŸæ­¤è¡Œä¸ºå¡«å†™æ ·ä¾‹ï¼ŒæŒ‡å¯¼ç»åŠäººå¡«å†™è¡¨æ ¼ã€‚", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                    ["", "åºå·ï¼ˆ*å¿…å¡«ï¼‰", "æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰", "ç§°è°“", "æ—…å®¢å§“ï¼ˆ*å¿…å¡«ï¼‰\nï¼ˆè¯ä»¶ä¿¡æ¯éå±…æ°‘èº«ä»½è¯ã€æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ã€æ— æ³•è¯†åˆ«è¯ä»¶æ—¶å¿…é¡»å¡«å†™è‹±æ–‡å§“åï¼‰", "æ‰‹æœºå·å‰ç¼€", "æ‰‹æœºå·", "é‚®ç®±", "è¯ä»¶ä¿¡æ¯", "", "è¯ä»¶è¡¥å……ä¿¡æ¯", "", "", "", "", "å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œå‡ºå‘åœ°åœ°å€", "", "", "", "", "å¤–ç±æ—…å®¢æ¶‰ç¾èˆªçº¿ï¼Œç›®çš„åœ°åœ°å€", "", "", "", ""],
                    ["", "1", "æˆäºº", "SD ç•™å­¦ç”Ÿ", "ç‹æˆäººä¸€", "86", "16666666666", "123@qq.com", "å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI", "11010319950509XXXX", "ç”·", "", "", "", "", "", "USA", "CA", "Los Angeles", "137 San rdino Rd", "91723", "USA", "CA", "Los Angeles", "137 San rdino Rd", "91723"],
                    ["", "2", "æˆäºº", "SD ç•™å­¦ç”Ÿ", "TEST/ONE", "86", "16666666666", "123@qq.com", "å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI", "11010120150307XXXX", "ç”·", "2015-03-07 00:00:00", "CN", "CN", "2025-10-01 00:00:00", "", "USA", "CA", "Los Angeles", "137 San rdino Rd", "91723", "USA", "CA", "Los Angeles", "137 San rdino Rd", "91723"],
                    [],
                    [],
                    ["æ¸©é¦¨æç¤ºï¼šè¯·ä¸è¦ä¿®æ”¹æ¨¡æ¿", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                    ["æ‰¹é‡å¡«å†™åŒºåŸŸè¯·ç»åŠäººåœ¨æ­¤åŒºåŸŸå¡«å†™è¡¨æ ¼ã€‚", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                    ["", "åºå·ï¼ˆ*å¿…å¡«ï¼‰", "æ—…å®¢ç±»å‹ï¼ˆ*å¿…å¡«ï¼‰", "ç§°è°“", "æ—…å®¢å§“åï¼ˆ*å¿…å¡«ï¼‰\nï¼ˆè¯ä»¶ä¿¡æ¯éå±…æ°‘èº«ä»½è¯ã€æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ã€æ— æ³•è¯†åˆ«è¯ä»¶æ—¶å¿…é¡»å¡«å†™è‹±æ–‡å§“åï¼‰", "æ‰‹æœºå·å‰ç¼€", "æ‰‹æœºå·", "é‚®ç®±", "è¯ä»¶ç±»å‹ï¼ˆèº«ä»½è¯ã€æŠ¤ç…§ç­‰ï¼‰", "è¯ä»¶å·ç ", "æ€§åˆ«", "å‡ºç”Ÿæ—¥æœŸ", "ç­¾å‘å›½ï¼ˆå›½å®¶/åœ°åŒºï¼‰", "å›½ç±ï¼ˆå›½å®¶/åœ°åŒºï¼‰", "è¯ä»¶æœ‰æ•ˆæœŸ", "å›½å®¶Country", "çœ/å·State", "åŸå¸‚City", "åœ°å€Address", "é‚®ç¼–Zip", "å›½å®¶Country", "çœ/å·State", "åŸå¸‚City", "åœ°å€Address", "é‚®ç¼–Zip"]
                ];
                
                // æ·»åŠ ç”¨æˆ·æ•°æ®åˆ°æ‰¹é‡å¡«å†™åŒºåŸŸ - ä½¿ç”¨å®é™…ä¿®æ”¹åçš„æ•°æ®
                passengerData.forEach((data, index) => {
                    const rowData = [
                        "", // Aåˆ—ç©º
                        (index + 1).toString(), // Båˆ—åºå·
                        data.passengerType || "æˆäºº", // Cåˆ—æ—…å®¢ç±»å‹ - ä½¿ç”¨è¡¨æ ¼ä¸­é€‰æ‹©çš„å€¼
                        data.title || "", // Dåˆ—ç§°è°“ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.name || "", // Eåˆ—æ—…å®¢å§“å - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.phonePrefix || settings.defaultPhonePrefix, // Fåˆ—æ‰‹æœºå·å‰ç¼€ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.phone || currentPhone, // Gåˆ—æ‰‹æœºå· - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.email || "", // Håˆ—é‚®ç®± - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.idType || "å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI", // Iåˆ—è¯ä»¶ç±»å‹ - ä½¿ç”¨è¡¨æ ¼ä¸­é€‰æ‹©çš„å€¼
                        data.idNumber || "", // Jåˆ—è¯ä»¶å·ç  - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.gender || "", // Kåˆ—æ€§åˆ« - ä½¿ç”¨è¡¨æ ¼ä¸­é€‰æ‹©çš„å€¼
                        data.birthDate || "", // Låˆ—å‡ºç”Ÿæ—¥æœŸ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.issueCountry || "", // Måˆ—ç­¾å‘å›½ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.nationality || "", // Nåˆ—å›½ç± - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.idExpiry || "", // Oåˆ—è¯ä»¶æœ‰æ•ˆæœŸ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.departureCountry || "", // Påˆ—å‡ºå‘åœ°å›½å®¶ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.departureState || "", // Qåˆ—å‡ºå‘åœ°çœ/å· - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.departureCity || "", // Råˆ—å‡ºå‘åœ°åŸå¸‚ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.departureAddress || "", // Såˆ—å‡ºå‘åœ°åœ°å€ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.departureZip || "", // Tåˆ—å‡ºå‘åœ°é‚®ç¼– - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.arrivalCountry || "", // Uåˆ—ç›®çš„åœ°å›½å®¶ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.arrivalState || "", // Våˆ—ç›®çš„åœ°çœ/å· - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.arrivalCity || "", // Wåˆ—ç›®çš„åœ°åŸå¸‚ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.arrivalAddress || "", // Xåˆ—ç›®çš„åœ°åœ°å€ - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                        data.arrivalZip || "" // Yåˆ—ç›®çš„åœ°é‚®ç¼– - ä½¿ç”¨è¡¨æ ¼ä¸­è¾“å…¥çš„å€¼
                    ];
                    tempOrderData.push(rowData);
                });
                
                // å¦‚æœç”¨æˆ·æ•°æ®å°‘äº6è¡Œï¼Œæ·»åŠ ç©ºè¡Œä»¥ä¿æŒæ¨¡æ¿ç»“æ„
                while (tempOrderData.length < 15) {
                    tempOrderData.push(new Array(25).fill(""));
                }
                
                const wsTemp = XLSX.utils.aoa_to_sheet(tempOrderData);
                XLSX.utils.book_append_sheet(wb, wsTemp, "ä¸´æ—¶è®¢å•");
                
                // åˆ›å»º"æ•°æ®æ¥æº"å·¥ä½œè¡¨
                const dataSourceData = [
                    ["æ•°æ®æ¥æºï¼ˆä¸è¦æ”¹ï¼‰", ""],
                    ["", ""],
                    ["æ—…å®¢ç±»å‹", "æˆäºº"],
                    ["", "å„¿ç«¥"],
                    ["", "å©´å„¿"],
                    ["", ""],
                    ["è¯ä»¶ç±»å‹", "å…¬æ°‘èº«ä»½è¯ / æ¸¯æ¾³å°å±…æ°‘å±…ä½è¯ FOID NI"],
                    ["", "ç‰¹æ®Šèº«ä»½è¯ / æ— æ³•è¯†åˆ«è¯ä»¶ FOID UU"],
                    ["", "æŠ¤ç…§ DOCS P"],
                    ["", "ç”µå­æŠ¤ç…§ DOCS IP"],
                    ["", "å†›æ–¹è¯ä»¶ DOCS M"],
                    ["", "å•†èˆ¹èˆ¹å‘˜è¯ï¼ˆæµ·å‘˜è¯ï¼‰DOCS G"],
                    ["", "æ¸¯æ¾³å±…æ°‘å¾€æ¥å†…åœ°é€šè¡Œè¯ / å°æ¹¾å±…æ°‘å¾€æ¥å¤§é™†é€šè¡Œè¯ DOCS A"],
                    ["", "é©»åå¤–äº¤äººå‘˜è¯ï¼ˆå¤–äº¤éƒ¨ç­¾å‘ï¼‰DOCS C"],
                    ["", "æˆ·å£æœ¬ã€å­¦ç”Ÿè¯ã€æˆ·å£æ‰€åœ¨åœ°å…¬å®‰æœºå…³å‡ºå…·çš„èº«ä»½è¯æ˜ DOCS I"],
                    ["", "å¤–å›½äººæ°¸ä¹…å±…ç•™è¯ / å¤–å›½äººå‡ºå…¥å¢ƒè¯ FOID NIæˆ–DOCS F"],
                    ["", "æ¸¯æ¾³å°é€šè¡Œè¯(å«ç”µå­) DOCS A"],
                    ["", "èŠ³é‚»å¡ï¼ˆç¾åŠ ï¼‰DOCS IN"],
                    ["", "DOCS T"],
                    ["", ""],
                    ["æ€§åˆ«", "ç”·"],
                    ["", "å¥³"],
                    ["", "æœªæŠ«éœ²æ€§åˆ«"]
                ];
                
                const wsData = XLSX.utils.aoa_to_sheet(dataSourceData);
                XLSX.utils.book_append_sheet(wb, wsData, "æ•°æ®æ¥æºï¼ˆä¸è¦æ”¹ï¼‰");
                
                // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
                XLSX.writeFile(wb, "ä¹˜æœºäººä¿¡æ¯æ‰¹é‡å¯¼å…¥.xlsx");
                
                // è®°å½•æ“ä½œå†å²
                addToHistory('å¯¼å‡ºExcel', { passengerCount: passengerData.length });
            } catch (error) {
                console.error('ç”ŸæˆExcelæ–‡ä»¶æ—¶å‡ºé”™:', error);
                showAdvancedError('ç”ŸæˆExcelæ–‡ä»¶å¤±è´¥: ' + error.message);
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                hideLoading();
            }
        }
        
        // é‡ç½®è¡¨å•
        document.getElementById('resetBtn').addEventListener('click', function() {
            showAdvancedConfirm(
                "ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰è¾“å…¥å†…å®¹å’Œè¡¨æ ¼æ•°æ®ã€‚",
                function() {
                    passengers = [];
                    currentPhone = '';
                    document.getElementById('passengerInput').value = '';
                    document.getElementById('phoneInput').value = '';
                    document.getElementById('passengerCount').textContent = '0';
                    document.getElementById('realTimeResults').style.display = 'none';
                    updateProgress(1);
                    updateStats();
                    showAdvancedSuccess('æ‰€æœ‰æ•°æ®å·²é‡ç½®');
                    
                    // æ¸…é™¤æœ¬åœ°å­˜å‚¨
                    localStorage.removeItem('passengerData');
                }
            );
        });
        
        // æ‰¹é‡ç¼–è¾‘ä¹˜å®¢
        function batchEditPassengers() {
            const checkedBoxes = document.querySelectorAll('.passenger-check:checked');
            if (checkedBoxes.length === 0) {
                showAdvancedError('è¯·é€‰æ‹©è¦ç¼–è¾‘çš„ä¹˜æœºäºº');
                return;
            }
            
            showBatchEditModal(checkedBoxes);
        }
        
        // æ˜¾ç¤ºæ‰¹é‡ç¼–è¾‘æ¨¡æ€çª—å£
        function showBatchEditModal(checkedBoxes) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'batchEditModal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">æ‰¹é‡ç¼–è¾‘ä¹˜æœºäººä¿¡æ¯</div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>é€‰æ‹©ç¼–è¾‘å­—æ®µ:</label>
                            <select id="batchEditField" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="phonePrefix">æ‰‹æœºå·å‰ç¼€</option>
                                <option value="title">ç§°è°“</option>
                                <option value="email">é‚®ç®±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ–°å€¼:</label>
                            <input type="text" id="batchEditValue" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="input-hint">
                            æ­¤æ“ä½œå°†æ›´æ–°é€‰ä¸­çš„ ${checkedBoxes.length} ä¸ªä¹˜æœºäºº
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="cancelBatchEdit" class="btn-secondary">å–æ¶ˆ</button>
                        <button id="confirmBatchEdit" class="btn-primary">ç¡®è®¤ä¿®æ”¹</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // äº‹ä»¶å¤„ç†
            document.getElementById('confirmBatchEdit').addEventListener('click', function() {
                const field = document.getElementById('batchEditField').value;
                const value = document.getElementById('batchEditValue').value;
                
                performBatchEdit(checkedBoxes, field, value);
                modal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            });
            
            document.getElementById('cancelBatchEdit').addEventListener('click', function() {
                modal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            });
        }
        
        // æ‰§è¡Œæ‰¹é‡ç¼–è¾‘
        function performBatchEdit(checkedBoxes, field, value) {
            const indicesToEdit = Array.from(checkedBoxes)
                .map(cb => parseInt(cb.getAttribute('data-index')));
            
            indicesToEdit.forEach(index => {
                // æ ¹æ®å­—æ®µæ›´æ–°ä¹˜å®¢æ•°æ®
                if (field === 'phonePrefix') {
                    // æ‰‹æœºå·å‰ç¼€é€»è¾‘
                } else if (field === 'title') {
                    // ç§°è°“é€»è¾‘
                } else if (field === 'email') {
                    // é‚®ç®±é€»è¾‘
                }
            });
            
            // æ›´æ–°æ˜¾ç¤º
            updateRealTimeResults();
            document.getElementById('batchActions').style.display = 'none';
            
            showAdvancedSuccess(`å·²æ‰¹é‡æ›´æ–° ${indicesToEdit.length} ä¸ªä¹˜æœºäººçš„${getFieldDisplayName(field)}`);
            addToHistory('æ‰¹é‡ç¼–è¾‘', { count: indicesToEdit.length, field: field });
        }
        
        // è·å–å­—æ®µæ˜¾ç¤ºåç§°
        function getFieldDisplayName(field) {
            const fieldNames = {
                'phonePrefix': 'æ‰‹æœºå·å‰ç¼€',
                'title': 'ç§°è°“',
                'email': 'é‚®ç®±'
            };
            return fieldNames[field] || field;
        }
        
        // æ‰¹é‡åˆ é™¤ä¹˜å®¢
        function batchDeletePassengers() {
            const checkedBoxes = document.querySelectorAll('.passenger-check:checked');
            if (checkedBoxes.length === 0) {
                showAdvancedError('è¯·é€‰æ‹©è¦åˆ é™¤çš„ä¹˜æœºäºº');
                return;
            }
            
            showAdvancedConfirm(
                `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checkedBoxes.length} ä¸ªä¹˜æœºäººå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚`,
                function() {
                    performBatchDelete(checkedBoxes);
                }
            );
        }
        
        // æ‰§è¡Œæ‰¹é‡åˆ é™¤
        function performBatchDelete(checkedBoxes) {
            // ä»åå¾€å‰åˆ é™¤ï¼Œé¿å…ç´¢å¼•é—®é¢˜
            const indicesToDelete = Array.from(checkedBoxes)
                .map(cb => parseInt(cb.getAttribute('data-index')))
                .sort((a, b) => b - a);
            
            indicesToDelete.forEach(index => {
                passengers.splice(index, 1);
            });
            
            // æ›´æ–°è¾“å…¥æ¡†å†…å®¹
            updateInputFromPassengers();
            
            // æ›´æ–°æ˜¾ç¤º
            updateRealTimeResults();
            document.getElementById('batchActions').style.display = 'none';
            
            showAdvancedSuccess(`å·²åˆ é™¤ ${indicesToDelete.length} ä¸ªä¹˜æœºäºº`);
            addToHistory('æ‰¹é‡åˆ é™¤', { count: indicesToDelete.length });
        }
        
        // æ ¹æ®ä¹˜å®¢æ•°æ®æ›´æ–°è¾“å…¥æ¡†
        function updateInputFromPassengers() {
            let text = '';
            passengers.forEach(passenger => {
                text += `ä¹˜æœºäººï¼š${passenger.name}\n`;
                text += `èº«ä»½è¯ï¼š${passenger.idNumber}\n`;
                if (passenger.ticketNumber) {
                    text += `ç¥¨å·ï¼š${passenger.ticketNumber}\n`;
                }
                text += '\n';
            });
            
            // æ·»åŠ èˆªç­ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
            if (passengers.length > 0 && passengers[0].flightNumber) {
                text += `èˆªç­å·ï¼š${passengers[0].flightNumber}\n`;
                text += `èµ·é™åœ°ï¼š${passengers[0].route}\n`;
                text += `èµ·é£æ—¶é—´ï¼š${passengers[0].flightTime}\n`;
            }
            
            document.getElementById('passengerInput').value = text.trim();
        }
        
        // å¯¼å…¥Excelæ–‡ä»¶ - å¢å¼ºç‰ˆæœ¬
        function importExcelFile(file) {
            showLoading();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    let importedCount = 0;
                    
                    // å°è¯•ä»å¤šä¸ªå¯èƒ½çš„å·¥ä½œè¡¨åç§°ä¸­è¯»å–æ•°æ®
                    const possibleSheets = ['ä¹˜æœºäººä¿¡æ¯', 'ä¹˜å®¢ä¿¡æ¯', 'Passenger', 'Sheet1'];
                    let worksheet = null;
                    
                    for (const sheetName of possibleSheets) {
                        if (workbook.SheetNames.includes(sheetName)) {
                            worksheet = workbook.Sheets[sheetName];
                            break;
                        }
                    }
                    
                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç‰¹å®šåç§°çš„å·¥ä½œè¡¨ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    if (!worksheet) {
                        worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    }
                    
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // æ™ºèƒ½è¯†åˆ«åˆ—ç´¢å¼•
                    const headerRow = jsonData[0] || [];
                    let nameCol = -1, idCol = -1, ticketCol = -1;
                    
                    headerRow.forEach((cell, index) => {
                        const cellText = String(cell).toLowerCase();
                        if (cellText.includes('å§“å') || cellText.includes('name')) nameCol = index;
                        if (cellText.includes('èº«ä»½è¯') || cellText.includes('id')) idCol = index;
                        if (cellText.includes('ç¥¨å·') || cellText.includes('ticket')) ticketCol = index;
                    });
                    
                    // å¦‚æœè‡ªåŠ¨è¯†åˆ«å¤±è´¥ï¼Œä½¿ç”¨å‰å‡ åˆ—
                    if (nameCol === -1) nameCol = 0;
                    if (idCol === -1) idCol = 1;
                    if (ticketCol === -1) ticketCol = 2;
                    
                    // è§£ææ•°æ®
                    let text = '';
                    jsonData.forEach((row, index) => {
                        if (index === 0) return; // è·³è¿‡è¡¨å¤´
                        if (row && row.length > Math.max(nameCol, idCol, ticketCol)) {
                            const name = row[nameCol] || '';
                            const id = row[idCol] || '';
                            const ticket = row[ticketCol] || '';
                            
                            if (name) {
                                text += `ä¹˜æœºäººï¼š${name}\n`;
                                if (id) text += `èº«ä»½è¯ï¼š${id}\n`;
                                if (ticket) text += `ç¥¨å·ï¼š${ticket}\n`;
                                text += '\n';
                                importedCount++;
                            }
                        }
                    });
                    
                    if (importedCount > 0) {
                        document.getElementById('passengerInput').value = text;
                        updateRealTimeResults();
                        showAdvancedSuccess(`æˆåŠŸå¯¼å…¥ ${importedCount} æ¡ä¹˜æœºäººä¿¡æ¯ï¼`);
                    } else {
                        showAdvancedError('æœªæ‰¾åˆ°å¯å¯¼å…¥çš„ä¹˜æœºäººæ•°æ®');
                    }
                } catch (error) {
                    console.error('Excelå¯¼å…¥é”™è¯¯:', error);
                    showAdvancedError('Excelæ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                } finally {
                    hideLoading();
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // å¯¼å‡ºæ•°æ®ä¸ºJSON
        function exportData() {
            const data = {
                passengers: passengers,
                phone: currentPhone,
                timestamp: new Date().toISOString(),
                settings: settings
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ä¹˜æœºäººæ•°æ®_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            link.click();
            
            addToHistory('å¯¼å‡ºæ•°æ®', { passengerCount: passengers.length });
        }
        
        // ä»JSONå¯¼å…¥æ•°æ®
        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.passengers && Array.isArray(data.passengers)) {
                        passengers = data.passengers;
                        currentPhone = data.phone || '';
                        
                        if (data.settings) {
                            settings = { ...settings, ...data.settings };
                            saveSettingsToStorage();
                            updateSettingsUI();
                        }
                        
                        updateInputFromPassengers();
                        updateRealTimeResults();
                        showAdvancedSuccess('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                        addToHistory('å¯¼å…¥æ•°æ®', { passengerCount: passengers.length });
                    } else {
                        showAdvancedError('æ— æ•ˆçš„æ•°æ®æ–‡ä»¶æ ¼å¼');
                    }
                } catch (error) {
                    console.error('æ•°æ®å¯¼å…¥é”™è¯¯:', error);
                    showAdvancedError('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('passengerToolSettings');
            if (savedSettings) {
                try {
                    settings = { ...settings, ...JSON.parse(savedSettings) };
                    updateSettingsUI();
                } catch (error) {
                    console.error('è®¾ç½®åŠ è½½å¤±è´¥ï¼š', error);
                }
            }
        }
        
        // æ›´æ–°è®¾ç½®UI
        function updateSettingsUI() {
            document.getElementById('autoSaveSetting').checked = settings.autoSave;
            document.getElementById('validateIdSetting').checked = settings.validateId;
            document.getElementById('defaultPhonePrefix').value = settings.defaultPhonePrefix;
        }
        
        // æ˜¾ç¤ºè®¾ç½®æ¨¡æ€çª—å£
        function showSettingsModal() {
            updateSettingsUI();
            document.getElementById('settingsModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('settingsModal').classList.add('show');
            }, 10);
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            settings.autoSave = document.getElementById('autoSaveSetting').checked;
            settings.validateId = document.getElementById('validateIdSetting').checked;
            settings.defaultPhonePrefix = document.getElementById('defaultPhonePrefix').value;
            
            saveSettingsToStorage();
            
            document.getElementById('settingsModal').classList.remove('show');
            setTimeout(() => {
                document.getElementById('settingsModal').style.display = 'none';
            }, 300);
            
            showAdvancedSuccess('è®¾ç½®å·²ä¿å­˜ï¼');
            addToHistory('ä¿å­˜è®¾ç½®', settings);
        }
        
        // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
        function saveSettingsToStorage() {
            localStorage.setItem('passengerToolSettings', JSON.stringify(settings));
        }
        
        // æœç´¢å’Œç­›é€‰ä¹˜å®¢
        function filterPassengers(keyword) {
            const passengerItems = document.querySelectorAll('.passenger-item');
            passengerItems.forEach(item => {
                const name = item.querySelector('.passenger-name .value').textContent;
                const idNumber = item.querySelector('.passenger-id .value').textContent;
                
                if (name.includes(keyword) || idNumber.includes(keyword)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // æ˜¾ç¤ºé«˜çº§ç¡®è®¤å¼¹çª—
        function showAdvancedConfirm(message, confirmCallback) {
            document.getElementById('confirmDeleteText').textContent = message;
            document.getElementById('confirmDeleteModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('confirmDeleteModal').classList.add('show');
            }, 10);
            
            // è®¾ç½®ç¡®è®¤æŒ‰é’®å›è°ƒ
            document.getElementById('confirmDelete').onclick = function() {
                confirmCallback();
                document.getElementById('confirmDeleteModal').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('confirmDeleteModal').style.display = 'none';
                }, 300);
            };
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            let adultCount = 0;
            let childCount = 0;
            let infantCount = 0;
            
            passengers.forEach(passenger => {
                let ageType;
                if (passenger.isForeign) {
                    // éèº«ä»½è¯ä¹˜å®¢ - æ ¹æ®å‡ºç”Ÿæ—¥æœŸè®¡ç®—
                    ageType = calculatePassengerTypeByBirthDate(passenger.birthDate);
                } else {
                    // èº«ä»½è¯ä¹˜å®¢
                    ageType = calculateAge(passenger.idNumber);
                }
                
                if (ageType === 'æˆäºº') adultCount++;
                else if (ageType === 'å„¿ç«¥') childCount++;
                else if (ageType === 'å©´å„¿') infantCount++;
            });
            
            document.getElementById('totalCount').textContent = passengers.length;
            document.getElementById('adultCount').textContent = adultCount;
            document.getElementById('childCount').textContent = childCount;
            document.getElementById('infantCount').textContent = infantCount;
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            const data = {
                passengers: passengers,
                phone: currentPhone,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('passengerData', JSON.stringify(data));
        }
        
        // æ·»åŠ åˆ°æ“ä½œå†å²
        function addToHistory(operation, data) {
            operationHistory.push({
                timestamp: new Date().toISOString(),
                operation: operation,
                data: data
            });
            
            // åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
            if (operationHistory.length > 50) {
                operationHistory = operationHistory.slice(-50);
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('operationHistory', JSON.stringify(operationHistory));
        }
        
        // èº«ä»½è¯å·ç éªŒè¯å‡½æ•° - å¢å¼ºç‰ˆæœ¬
        function validateIdNumber(idNumber) {
            if (!idNumber) return false;
            
            // 15ä½èº«ä»½è¯éªŒè¯
            if (idNumber.length === 15) {
                return /^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/.test(idNumber);
            }
            
            // 18ä½èº«ä»½è¯éªŒè¯
            if (idNumber.length === 18) {
                // åŸºæœ¬æ ¼å¼éªŒè¯
                const idPattern = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
                if (!idPattern.test(idNumber)) return false;
                
                // æ ¡éªŒç éªŒè¯
                const weight = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
                const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
                
                let sum = 0;
                for (let i = 0; i < 17; i++) {
                    sum += parseInt(idNumber.charAt(i)) * weight[i];
                }
                
                const checkCode = checkCodes[sum % 11];
                return idNumber.charAt(17).toUpperCase() === checkCode;
            }
            
            return false;
        }
        
        // åœ¨é¡µé¢åŠ è½½æ—¶å°è¯•åŠ è½½æœ¬åœ°æ•°æ®
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('passengerData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.passengers && Array.isArray(data.passengers)) {
                        passengers = data.passengers;
                        currentPhone = data.phone || '';
                        
                        // æ›´æ–°è¾“å…¥æ¡†
                        updateInputFromPassengers();
                        
                        // æ›´æ–°æ˜¾ç¤º
                        updateRealTimeResults();
                        
                        // å¦‚æœæ‰‹æœºå·ç å·²ä¿å­˜ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥
                        if (currentPhone) {
                            showConfirmPage();
                            updateProgress(3);
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥ï¼š', error);
                }
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®å¸®åŠ©
        function showKeyboardShortcuts() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">é”®ç›˜å¿«æ·é”®</div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><kbd>Ctrl</kbd> + <kbd>Enter</kbd></div>
                            <div>ç”Ÿæˆè¡¨å•</div>
                            <div><kbd>Esc</kbd></div>
                            <div>å…³é—­å¼¹çª—</div>
                            <div><kbd>Ctrl</kbd> + <kbd>S</kbd></div>
                            <div>ä¿å­˜æ•°æ®</div>
                            <div><kbd>Ctrl</kbd> + <kbd>E</kbd></div>
                            <div>å¯¼å‡ºExcel</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="closeShortcuts" class="btn-primary">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            document.getElementById('closeShortcuts').addEventListener('click', function() {
                modal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            });
        }
        
        // æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
        function validatePassengerData() {
            return passengers.every(passenger => {
                if (passenger.isForeign) {
                    return passenger.name && passenger.documentNumber && passenger.gender && passenger.birthDate;
                } else {
                    return passenger.name && passenger.idNumber && (passenger.idNumber.length === 15 || passenger.idNumber.length === 18);
                }
            });
        }
    </script>
</body>
</html>